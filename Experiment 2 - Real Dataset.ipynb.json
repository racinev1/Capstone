{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "8bf1ecb4",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import seaborn as sns\n",
    "import matplotlib.pyplot as plt\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "import plotly.graph_objects as go\n",
    "import torch"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "5c0e374e",
   "metadata": {},
   "outputs": [],
   "source": [
    "os.chdir('/Users/vincent/Desktop/Capstone Project/Code')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "ff66875b",
   "metadata": {},
   "outputs": [],
   "source": [
    "from hp_tuning import HPTuning\n",
    "from nn import IEEE_MPO\n",
    "from losses import SharpeRatio\n",
    "from data import InRAMDataset, RigidDataLoader, prepare_standard_scaler, Scale \n",
    "from online_learning import OnlineLearning\n",
    "from experiments import Run\n",
    "from callbacks import EarlyStoppingCallback\n",
    "from metrics import maximum_drawdown\n",
    "from transaction import TransactionCost"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "d6fadf29",
   "metadata": {},
   "outputs": [],
   "source": [
    "os.chdir('/Users/vincent/Desktop/Capstone Project/Data')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "1529a8a7",
   "metadata": {},
   "outputs": [],
   "source": [
    "mkt_ret = pd.read_parquet('mkt_ret.prq')['mkt_ret']\n",
    "universe_df = pd.read_parquet('universe.prq')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "f2e4c7c9",
   "metadata": {},
   "outputs": [],
   "source": [
    "#choose 20 stocks with data from 1926-2020\n",
    "stocks = universe_df.groupby('PERMNO')['RET'].count().nlargest(20).index"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "675a093d",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = universe_df.loc[stocks]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "3138a87f",
   "metadata": {},
   "outputs": [],
   "source": [
    "#remove unecessary columns\n",
    "df.drop(['TICKER', 'CUSIP', 'PRC', 'SHROUT'], axis=1, inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "03274c95",
   "metadata": {},
   "outputs": [],
   "source": [
    "#remove missing values\n",
    "df.dropna(inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "d9f8c1d3",
   "metadata": {},
   "outputs": [],
   "source": [
    "#merge market return\n",
    "df = pd.merge(df, mkt_ret, left_index=True, right_index=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "2233a66d",
   "metadata": {},
   "outputs": [],
   "source": [
    "#find active return\n",
    "df['active_ret'] = df['RET'] - df['mkt_ret']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "9e987cbf",
   "metadata": {},
   "outputs": [],
   "source": [
    "#pivot dataframe\n",
    "df = df['active_ret'].unstack(level=0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "d713329f",
   "metadata": {},
   "outputs": [],
   "source": [
    "n_timesteps, n_assets = df.shape\n",
    "lookback, gap, horizon = 36, 0, 6\n",
    "n_samples = n_timesteps - lookback - horizon - gap + 1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "e575cc5b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Train range: 0:878\n",
      "Test range: 921:1098\n"
     ]
    }
   ],
   "source": [
    "split_ix = int(n_samples * 0.8)\n",
    "indices_train = list(range(split_ix))\n",
    "indices_test = list(range(split_ix + lookback + horizon, n_samples))\n",
    "\n",
    "print('Train range: {}:{}\\nTest range: {}:{}'.format(indices_train[0], indices_train[-1],\n",
    "                                                     indices_test[0], indices_test[-1]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "5125aee4",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "X: (1099, 1, 36, 20), y: (1099, 1, 6, 20)\n"
     ]
    }
   ],
   "source": [
    "# To obtain the feature matrix :code:`X` and the target :code:`y` we apply the rolling window\n",
    "# strategy.\n",
    "X_list, y_list = [], []\n",
    "\n",
    "for i in range(lookback, n_timesteps - horizon - gap + 1):\n",
    "    X_list.append(df.iloc[i - lookback: i, :])\n",
    "    y_list.append(df.iloc[i + gap: i + gap + horizon, :])\n",
    "\n",
    "X = np.stack(X_list, axis=0)[:, None, ...]\n",
    "y = np.stack(y_list, axis=0)[:, None, ...]\n",
    "\n",
    "print('X: {}, y: {}'.format(X.shape, y.shape))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "b0c273f3",
   "metadata": {},
   "outputs": [],
   "source": [
    "# #transformation for adversarial learning\n",
    "# noise = Noise()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "2849cae3",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "mean: [0.0025428], std: [0.07368071]\n"
     ]
    }
   ],
   "source": [
    "means, stds = prepare_standard_scaler(X, indices=indices_train)\n",
    "print('mean: {}, std: {}'.format(means, stds))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "f5d9e45a",
   "metadata": {},
   "outputs": [],
   "source": [
    "# We can now construct the :code:`InRAMDataset`. \n",
    "\n",
    "dataset = InRAMDataset(X, y, transform=Scale(means, stds), asset_names=np.arange(20))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "72671be0",
   "metadata": {},
   "outputs": [],
   "source": [
    "# We will minimize the negative of the Sortino Ratio\n",
    "loss = SharpeRatio(input_type='simple')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 107,
   "id": "bd9f552a",
   "metadata": {},
   "outputs": [],
   "source": [
    "callbacks = [EarlyStoppingCallback(metric_name='loss', dataloader_name='test', patience=5),\n",
    "             ]"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "908e1641",
   "metadata": {},
   "source": [
    "### Hyperparameter Tuning"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "4b68b882",
   "metadata": {},
   "outputs": [],
   "source": [
    "#define hyperparameter tuner with Optuna\n",
    "tuner = HPTuning(dataset, indices_train, loss, n_splits=5, n_trials=20, n_epochs=15)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "5c39dd74",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-06 16:01:46,893]\u001b[0m A new study created in memory with name: no-name-7a13fc53-e547-4ff6-980b-cea662ab753c\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.14009, test_loss=-0.0730\n",
      "Epoch 1: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.14261, test_loss=-0.0760\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.14535, test_loss=-0.0763\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.14779, test_loss=-0.0785\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.15019, test_loss=-0.0792\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.15290, test_loss=-0.0807\n",
      "Epoch 6: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.15597, test_loss=-0.0815\n",
      "Epoch 7: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.16056, test_loss=-0.0813\n",
      "Epoch 8: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.17011, test_loss=-0.0821\n",
      "Epoch 9: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.17932, test_loss=-0.0797\n",
      "Epoch 10: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.17789, test_loss=-0.075\n",
      "Epoch 11: 100%|█| 11/11 [00:21<00:00,  2.00s/it, loss=-0.17969, test_loss=-0.077\n",
      "Epoch 12: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.17678, test_loss=-0.078\n",
      "Epoch 13: 100%|█| 11/11 [00:22<00:00,  2.00s/it, loss=-0.17471, test_loss=-0.076\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.09s/it, loss=-0.19771, test_loss=-0.1374\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.07s/it, loss=-0.20356, test_loss=-0.1374\n",
      "Epoch 2: 100%|█| 11/11 [00:23<00:00,  2.11s/it, loss=-0.20902, test_loss=-0.1388\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.21427, test_loss=-0.1413\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.10s/it, loss=-0.21956, test_loss=-0.1437\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.22621, test_loss=-0.1476\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.24093, test_loss=-0.1476\n",
      "Epoch 7: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.25824, test_loss=-0.1404\n",
      "Epoch 8: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.26753, test_loss=-0.1396\n",
      "Epoch 9: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.27600, test_loss=-0.1402\n",
      "Epoch 10: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.28868, test_loss=-0.140\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.10s/it, loss=-0.10475, test_loss=-0.1249\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.10874, test_loss=-0.1223\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.11406, test_loss=-0.1201\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.11s/it, loss=-0.11913, test_loss=-0.1175\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.12117, test_loss=-0.1133\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.13116, test_loss=-0.1144\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.12997, test_loss=-0.0860\n",
      "Epoch 1: 100%|█| 11/11 [00:25<00:00,  2.33s/it, loss=-0.13716, test_loss=-0.0854\n",
      "Epoch 2: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.14606, test_loss=-0.0887\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.15286, test_loss=-0.0918\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.16464, test_loss=-0.0945\n",
      "Epoch 5: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.18414, test_loss=-0.1098\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.20442, test_loss=-0.1070\n",
      "Epoch 7: 100%|█| 11/11 [00:20<00:00,  1.87s/it, loss=-0.21162, test_loss=-0.1105\n",
      "Epoch 8: 100%|█| 11/11 [00:20<00:00,  1.87s/it, loss=-0.20545, test_loss=-0.1050\n",
      "Epoch 9: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.21904, test_loss=-0.1139\n",
      "Epoch 10: 100%|█| 11/11 [00:20<00:00,  1.84s/it, loss=-0.23625, test_loss=-0.113\n",
      "Epoch 11: 100%|█| 11/11 [00:20<00:00,  1.85s/it, loss=-0.25032, test_loss=-0.114\n",
      "Epoch 12: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.25178, test_loss=-0.112\n",
      "Epoch 13: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.25266, test_loss=-0.109\n",
      "Epoch 14: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.25085, test_loss=-0.120\n",
      "Epoch 0: 100%|█| 11/11 [00:22<00:00,  2.00s/it, loss=-0.19091, test_loss=-0.1534\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.20010, test_loss=-0.1519\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.05s/it, loss=-0.21077, test_loss=-0.1539\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.22426, test_loss=-0.1519\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.98s/it, loss=-0.23809, test_loss=-0.1504\n",
      "Epoch 5: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.25257, test_loss=-0.1488\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.26149, test_loss=-0.1477\n",
      "Epoch 7: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.27159, test_loss=-0.1463\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-06 16:22:22,326]\u001b[0m Trial 0 finished with value: -0.12353427708148956 and parameters: {'lr': 0.002300443871712203, 'hidden_channels': 7, 'kernel_size': 9, 'risk_aversion': 8.447468359158878, 'transaction_cost': 0.527730619030137, 'min_weight': 0.007768995891143438, 'max_weight': 0.19235718572911176}. Best is trial 0 with value: -0.12353427708148956.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.10819, test_loss=-0.1131\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.07s/it, loss=-0.10995, test_loss=-0.1104\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.07s/it, loss=-0.11053, test_loss=-0.1102\n",
      "Epoch 3: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.11911, test_loss=-0.1205\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.17330, test_loss=-0.1202\n",
      "Epoch 5: 100%|█| 11/11 [00:27<00:00,  2.51s/it, loss=-0.19858, test_loss=-0.1260\n",
      "Epoch 6: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.20586, test_loss=-0.1233\n",
      "Epoch 7: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.22024, test_loss=-0.1285\n",
      "Epoch 8: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.25064, test_loss=-0.1297\n",
      "Epoch 9: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.26939, test_loss=-0.1375\n",
      "Epoch 10: 100%|█| 11/11 [00:26<00:00,  2.38s/it, loss=-0.27309, test_loss=-0.135\n",
      "Epoch 11: 100%|█| 11/11 [00:23<00:00,  2.16s/it, loss=-0.27761, test_loss=-0.136\n",
      "Epoch 12: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.27942, test_loss=-0.128\n",
      "Epoch 13: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.28941, test_loss=-0.117\n",
      "Epoch 14: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.30247, test_loss=-0.130\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.98s/it, loss=-0.17937, test_loss=-0.1518\n",
      "Epoch 1: 100%|█| 11/11 [00:21<00:00,  2.00s/it, loss=-0.21007, test_loss=-0.1502\n",
      "Epoch 2: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.22783, test_loss=-0.1460\n",
      "Epoch 3: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.25482, test_loss=-0.1360\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.27058, test_loss=-0.1480\n",
      "Epoch 5: 100%|█| 11/11 [00:21<00:00,  2.00s/it, loss=-0.28088, test_loss=-0.1519\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.28207, test_loss=-0.1595\n",
      "Epoch 7: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.28626, test_loss=-0.1559\n",
      "Epoch 8: 100%|█| 11/11 [00:22<00:00,  2.04s/it, loss=-0.29055, test_loss=-0.1552\n",
      "Epoch 9: 100%|█| 11/11 [00:22<00:00,  2.04s/it, loss=-0.28666, test_loss=-0.1499\n",
      "Epoch 10: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.31699, test_loss=-0.168\n",
      "Epoch 11: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.32977, test_loss=-0.159\n",
      "Epoch 12: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.34068, test_loss=-0.166\n",
      "Epoch 13: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.33704, test_loss=-0.160\n",
      "Epoch 14: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.35180, test_loss=-0.148\n",
      "Epoch 0: 100%|█| 11/11 [00:28<00:00,  2.62s/it, loss=-0.12983, test_loss=-0.1037\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.13999, test_loss=-0.1102\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.15808, test_loss=-0.1239\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.18s/it, loss=-0.18129, test_loss=-0.1445\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.20731, test_loss=-0.1528\n",
      "Epoch 5: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.23298, test_loss=-0.1525\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.26027, test_loss=-0.1393\n",
      "Epoch 7: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.26669, test_loss=-0.1492\n",
      "Epoch 8: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.28192, test_loss=-0.1429\n",
      "Epoch 9: 100%|█| 11/11 [00:20<00:00,  1.85s/it, loss=-0.31138, test_loss=-0.1486\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.10s/it, loss=-0.11346, test_loss=-0.1018\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.07s/it, loss=-0.14833, test_loss=-0.1142\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.18033, test_loss=-0.1193\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.18479, test_loss=-0.1164\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.17345, test_loss=-0.1122\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.18099, test_loss=-0.1253\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.18004, test_loss=-0.1311\n",
      "Epoch 7: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.16629, test_loss=-0.1324\n",
      "Epoch 8: 100%|█| 11/11 [31:30<00:00, 171.89s/it, loss=-0.15335, test_loss=-0.133\n",
      "Epoch 9: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.16744, test_loss=-0.1250\n",
      "Epoch 10: 100%|█| 11/11 [00:29<00:00,  2.66s/it, loss=-0.17824, test_loss=-0.131\n",
      "Epoch 11: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.18616, test_loss=-0.105\n",
      "Epoch 12: 100%|█| 11/11 [00:26<00:00,  2.38s/it, loss=-0.17692, test_loss=-0.097\n",
      "Epoch 13: 100%|█| 11/11 [00:27<00:00,  2.52s/it, loss=-0.21009, test_loss=-0.104\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.11s/it, loss=-0.19269, test_loss=-0.1674\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.09s/it, loss=-0.21657, test_loss=-0.1869\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.23027, test_loss=-0.1785\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.24996, test_loss=-0.1763\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.11s/it, loss=-0.25906, test_loss=-0.1786\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.28841, test_loss=-0.1756\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.30166, test_loss=-0.1722\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-06 17:18:04,948]\u001b[0m Trial 1 finished with value: -0.13140267133712769 and parameters: {'lr': 0.008138044479761897, 'hidden_channels': 7, 'kernel_size': 4, 'risk_aversion': 2.119129488181982e-05, 'transaction_cost': 0.037271548124911326, 'min_weight': 0.017266172488724096, 'max_weight': 0.13726006900251103}. Best is trial 1 with value: -0.13140267133712769.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.10s/it, loss=-0.12246, test_loss=-0.0968\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.40s/it, loss=-0.12318, test_loss=-0.0969\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.12324, test_loss=-0.0969\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.21s/it, loss=-0.12381, test_loss=-0.0969\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.12357, test_loss=-0.0970\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.18s/it, loss=-0.12376, test_loss=-0.0970\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.33s/it, loss=-0.12374, test_loss=-0.0971\n",
      "Epoch 7: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.12399, test_loss=-0.0971\n",
      "Epoch 8: 100%|█| 11/11 [00:27<00:00,  2.49s/it, loss=-0.12435, test_loss=-0.0971\n",
      "Epoch 9: 100%|█| 11/11 [00:23<00:00,  2.18s/it, loss=-0.12431, test_loss=-0.0971\n",
      "Epoch 10: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.12455, test_loss=-0.097\n",
      "Epoch 11: 100%|█| 11/11 [00:22<00:00,  2.09s/it, loss=-0.12446, test_loss=-0.097\n",
      "Epoch 12: 100%|█| 11/11 [00:23<00:00,  2.18s/it, loss=-0.12450, test_loss=-0.097\n",
      "Epoch 13: 100%|█| 11/11 [00:26<00:00,  2.38s/it, loss=-0.12434, test_loss=-0.097\n",
      "Epoch 14: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.12458, test_loss=-0.097\n",
      "Epoch 0: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.17013, test_loss=-0.1539\n",
      "Epoch 1: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.16954, test_loss=-0.1541\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.17092, test_loss=-0.1543\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.17108, test_loss=-0.1546\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.17177, test_loss=-0.1547\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.17206, test_loss=-0.1549\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.17233, test_loss=-0.1552\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.17325, test_loss=-0.1553\n",
      "Epoch 8: 100%|█| 11/11 [00:27<00:00,  2.49s/it, loss=-0.17379, test_loss=-0.1555\n",
      "Epoch 9: 100%|█| 11/11 [00:28<00:00,  2.60s/it, loss=-0.17430, test_loss=-0.1557\n",
      "Epoch 10: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.17366, test_loss=-0.155\n",
      "Epoch 11: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.17443, test_loss=-0.156\n",
      "Epoch 12: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.17522, test_loss=-0.156\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.17541, test_loss=-0.156\n",
      "Epoch 14: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.17567, test_loss=-0.156\n",
      "Epoch 0: 100%|█| 11/11 [00:28<00:00,  2.55s/it, loss=-0.13719, test_loss=-0.0980\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.13749, test_loss=-0.0981\n",
      "Epoch 2: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.13794, test_loss=-0.0982\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.13783, test_loss=-0.0982\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.13786, test_loss=-0.0982\n",
      "Epoch 5: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.13810, test_loss=-0.0982\n",
      "Epoch 6: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.13834, test_loss=-0.0983\n",
      "Epoch 7: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.13809, test_loss=-0.0983\n",
      "Epoch 8: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.13882, test_loss=-0.0983\n",
      "Epoch 9: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.13885, test_loss=-0.0984\n",
      "Epoch 10: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.13871, test_loss=-0.098\n",
      "Epoch 11: 100%|█| 11/11 [00:27<00:00,  2.47s/it, loss=-0.13907, test_loss=-0.098\n",
      "Epoch 12: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.13933, test_loss=-0.098\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.13917, test_loss=-0.098\n",
      "Epoch 14: 100%|█| 11/11 [00:27<00:00,  2.50s/it, loss=-0.13965, test_loss=-0.098\n",
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.11124, test_loss=-0.1010\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.11083, test_loss=-0.1011\n",
      "Epoch 2: 100%|█| 11/11 [00:26<00:00,  2.40s/it, loss=-0.11122, test_loss=-0.1011\n",
      "Epoch 3: 100%|█| 11/11 [00:27<00:00,  2.46s/it, loss=-0.11099, test_loss=-0.1012\n",
      "Epoch 4: 100%|█| 11/11 [00:26<00:00,  2.38s/it, loss=-0.11092, test_loss=-0.1012\n",
      "Epoch 5: 100%|█| 11/11 [00:27<00:00,  2.48s/it, loss=-0.11129, test_loss=-0.1013\n",
      "Epoch 6: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.11187, test_loss=-0.1013\n",
      "Epoch 7: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.11199, test_loss=-0.1014\n",
      "Epoch 8: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.11195, test_loss=-0.1014\n",
      "Epoch 9: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.11165, test_loss=-0.1014\n",
      "Epoch 10: 100%|█| 11/11 [00:28<00:00,  2.57s/it, loss=-0.11236, test_loss=-0.101\n",
      "Epoch 11: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.11259, test_loss=-0.101\n",
      "Epoch 12: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.11279, test_loss=-0.101\n",
      "Epoch 13: 100%|█| 11/11 [00:27<00:00,  2.48s/it, loss=-0.11316, test_loss=-0.101\n",
      "Epoch 14: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.11307, test_loss=-0.101\n",
      "Epoch 0: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.21057, test_loss=-0.1428\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.21114, test_loss=-0.1429\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.33s/it, loss=-0.21119, test_loss=-0.1429\n",
      "Epoch 3: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.21140, test_loss=-0.1429\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.21146, test_loss=-0.1429\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.21134, test_loss=-0.1429\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.21143, test_loss=-0.1429\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.21152, test_loss=-0.1429\n",
      "Epoch 8: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.21161, test_loss=-0.1429\n",
      "Epoch 9: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.21168, test_loss=-0.1429\n",
      "Epoch 10: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.21178, test_loss=-0.143\n",
      "Epoch 11: 100%|█| 11/11 [00:25<00:00,  2.27s/it, loss=-0.21186, test_loss=-0.143\n",
      "Epoch 12: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.21193, test_loss=-0.143\n",
      "Epoch 13: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.21200, test_loss=-0.143\n",
      "Epoch 14: 100%|█| 11/11 [00:22<00:00,  2.09s/it, loss=-0.21208, test_loss=-0.143\n",
      "\u001b[32m[I 2021-12-06 17:51:17,840]\u001b[0m Trial 2 finished with value: -0.13508586585521698 and parameters: {'lr': 2.618480519309709e-05, 'hidden_channels': 8, 'kernel_size': 7, 'risk_aversion': 0.00018389216699277804, 'transaction_cost': 0.00022200460294910835, 'min_weight': 0.029215976005020877, 'max_weight': 0.3922434060336006}. Best is trial 2 with value: -0.13508586585521698.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.12262, test_loss=-0.0977\n",
      "Epoch 1: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.12382, test_loss=-0.0979\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.12332, test_loss=-0.0981\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.12477, test_loss=-0.0982\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.12489, test_loss=-0.0984\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.12558, test_loss=-0.0985\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.12594, test_loss=-0.0986\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.12621, test_loss=-0.0986\n",
      "Epoch 8: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.12666, test_loss=-0.0986\n",
      "Epoch 9: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.12689, test_loss=-0.0986\n",
      "Epoch 10: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.12703, test_loss=-0.098\n",
      "Epoch 11: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.12698, test_loss=-0.098\n",
      "Epoch 12: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.12770, test_loss=-0.098\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.12814, test_loss=-0.098\n",
      "Epoch 14: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.12822, test_loss=-0.098\n",
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.13344, test_loss=-0.2046\n",
      "Epoch 1: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.13375, test_loss=-0.2047\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.13499, test_loss=-0.2047\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.13638, test_loss=-0.2047\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.13625, test_loss=-0.2047\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.13702, test_loss=-0.2046\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.13841, test_loss=-0.2047\n",
      "Epoch 7: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.13857, test_loss=-0.2047\n",
      "Epoch 8: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.13923, test_loss=-0.2048\n",
      "Epoch 9: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.14048, test_loss=-0.2048\n",
      "Epoch 10: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.14071, test_loss=-0.204\n",
      "Epoch 11: 100%|█| 11/11 [00:26<00:00,  2.44s/it, loss=-0.14167, test_loss=-0.204\n",
      "Epoch 12: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.14275, test_loss=-0.204\n",
      "Epoch 13: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.14297, test_loss=-0.204\n",
      "Epoch 14: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.14356, test_loss=-0.204\n",
      "Epoch 0: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.14242, test_loss=-0.0847\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.14375, test_loss=-0.0850\n",
      "Epoch 2: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.14563, test_loss=-0.0851\n",
      "Epoch 3: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.14732, test_loss=-0.0852\n",
      "Epoch 4: 100%|█| 11/11 [00:28<00:00,  2.55s/it, loss=-0.14807, test_loss=-0.0852\n",
      "Epoch 5: 100%|█| 11/11 [00:29<00:00,  2.71s/it, loss=-0.14934, test_loss=-0.0853\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.15005, test_loss=-0.0855\n",
      "Epoch 7: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.15107, test_loss=-0.0856\n",
      "Epoch 8: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.15169, test_loss=-0.0858\n",
      "Epoch 9: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.15227, test_loss=-0.0859\n",
      "Epoch 10: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.15280, test_loss=-0.085\n",
      "Epoch 11: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.15328, test_loss=-0.085\n",
      "Epoch 12: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.15379, test_loss=-0.085\n",
      "Epoch 13: 100%|█| 11/11 [00:24<00:00,  2.21s/it, loss=-0.15455, test_loss=-0.086\n",
      "Epoch 14: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.15519, test_loss=-0.085\n",
      "Epoch 0: 100%|█| 11/11 [00:22<00:00,  2.00s/it, loss=-0.10239, test_loss=-0.1114\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.10206, test_loss=-0.1116\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.10347, test_loss=-0.1118\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.10504, test_loss=-0.1120\n",
      "Epoch 4: 100%|█| 11/11 [00:22<00:00,  2.05s/it, loss=-0.10595, test_loss=-0.1121\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.09s/it, loss=-0.10714, test_loss=-0.1123\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.10874, test_loss=-0.1125\n",
      "Epoch 7: 100%|█| 11/11 [00:28<00:00,  2.56s/it, loss=-0.11005, test_loss=-0.1127\n",
      "Epoch 8: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.11164, test_loss=-0.1129\n",
      "Epoch 9: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.11313, test_loss=-0.1131\n",
      "Epoch 10: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.11474, test_loss=-0.113\n",
      "Epoch 11: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.11675, test_loss=-0.113\n",
      "Epoch 12: 100%|█| 11/11 [00:23<00:00,  2.10s/it, loss=-0.11865, test_loss=-0.113\n",
      "Epoch 13: 100%|█| 11/11 [00:22<00:00,  2.04s/it, loss=-0.11978, test_loss=-0.113\n",
      "Epoch 14: 100%|█| 11/11 [00:23<00:00,  2.10s/it, loss=-0.12172, test_loss=-0.113\n",
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.18524, test_loss=-0.1646\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.18783, test_loss=-0.1648\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.18837, test_loss=-0.1649\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.18881, test_loss=-0.1650\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.19014, test_loss=-0.1651\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.19138, test_loss=-0.1652\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.27s/it, loss=-0.19254, test_loss=-0.1653\n",
      "Epoch 7: 100%|█| 11/11 [00:22<00:00,  2.07s/it, loss=-0.19348, test_loss=-0.1654\n",
      "Epoch 8: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.19439, test_loss=-0.1654\n",
      "Epoch 9: 100%|█| 11/11 [00:26<00:00,  2.40s/it, loss=-0.19513, test_loss=-0.1655\n",
      "Epoch 10: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.19604, test_loss=-0.165\n",
      "Epoch 11: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.19692, test_loss=-0.165\n",
      "Epoch 12: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.19762, test_loss=-0.165\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.19841, test_loss=-0.165\n",
      "Epoch 14: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.19912, test_loss=-0.165\n",
      "\u001b[32m[I 2021-12-06 18:22:42,795]\u001b[0m Trial 3 finished with value: -0.1316809207201004 and parameters: {'lr': 6.546016992367398e-05, 'hidden_channels': 14, 'kernel_size': 12, 'risk_aversion': 0.0061513255118065355, 'transaction_cost': 0.2741945550935342, 'min_weight': 0.009843015442894499, 'max_weight': 0.38091806002678835}. Best is trial 2 with value: -0.13508586585521698.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.16s/it, loss=-0.15505, test_loss=-0.0597\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.38s/it, loss=-0.15683, test_loss=-0.0608\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.15926, test_loss=-0.0615\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.16169, test_loss=-0.0616\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.16397, test_loss=-0.0618\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.16502, test_loss=-0.0620\n",
      "Epoch 6: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.16638, test_loss=-0.0622\n",
      "Epoch 7: 100%|█| 11/11 [00:27<00:00,  2.50s/it, loss=-0.16904, test_loss=-0.0625\n",
      "Epoch 8: 100%|█| 11/11 [00:27<00:00,  2.48s/it, loss=-0.17003, test_loss=-0.0627\n",
      "Epoch 9: 100%|█| 11/11 [00:24<00:00,  2.21s/it, loss=-0.17257, test_loss=-0.0635\n",
      "Epoch 10: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.17605, test_loss=-0.064\n",
      "Epoch 11: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.17878, test_loss=-0.065\n",
      "Epoch 12: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.18175, test_loss=-0.067\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.18628, test_loss=-0.070\n",
      "Epoch 14: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.19443, test_loss=-0.075\n",
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.17064, test_loss=-0.1679\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.09s/it, loss=-0.17519, test_loss=-0.1690\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.17814, test_loss=-0.1697\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.17972, test_loss=-0.1706\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.18265, test_loss=-0.1716\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.18570, test_loss=-0.1724\n",
      "Epoch 6: 100%|█| 11/11 [00:23<00:00,  2.18s/it, loss=-0.18964, test_loss=-0.1731\n",
      "Epoch 7: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.19402, test_loss=-0.1741\n",
      "Epoch 8: 100%|█| 11/11 [00:21<00:00,  2.00s/it, loss=-0.19927, test_loss=-0.1760\n",
      "Epoch 9: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.20922, test_loss=-0.1805\n",
      "Epoch 10: 100%|█| 11/11 [00:23<00:00,  2.11s/it, loss=-0.22483, test_loss=-0.184\n",
      "Epoch 11: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.23207, test_loss=-0.182\n",
      "Epoch 12: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.24843, test_loss=-0.181\n",
      "Epoch 13: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.25679, test_loss=-0.182\n",
      "Epoch 14: 100%|█| 11/11 [00:20<00:00,  1.90s/it, loss=-0.26651, test_loss=-0.179\n",
      "Epoch 0: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.11987, test_loss=-0.1150\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.12034, test_loss=-0.1154\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.12092, test_loss=-0.1153\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.12270, test_loss=-0.1151\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.12408, test_loss=-0.1149\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.12557, test_loss=-0.1148\n",
      "Epoch 6: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.12801, test_loss=-0.1148\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.09211, test_loss=-0.1194\n",
      "Epoch 1: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.09276, test_loss=-0.1193\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.09418, test_loss=-0.1189\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.09666, test_loss=-0.1183\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.09854, test_loss=-0.1176\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.10089, test_loss=-0.1168\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.17369, test_loss=-0.1809\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.17928, test_loss=-0.1813\n",
      "Epoch 2: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.18206, test_loss=-0.1818\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.11s/it, loss=-0.18468, test_loss=-0.1820\n",
      "Epoch 4: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.18663, test_loss=-0.1823\n",
      "Epoch 5: 100%|█| 11/11 [00:22<00:00,  2.05s/it, loss=-0.18926, test_loss=-0.1822\n",
      "Epoch 6: 100%|█| 11/11 [00:22<00:00,  2.04s/it, loss=-0.19234, test_loss=-0.1825\n",
      "Epoch 7: 100%|█| 11/11 [00:22<00:00,  2.07s/it, loss=-0.19542, test_loss=-0.1832\n",
      "Epoch 8: 100%|█| 11/11 [00:22<00:00,  2.04s/it, loss=-0.19948, test_loss=-0.1839\n",
      "Epoch 9: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.20370, test_loss=-0.1848\n",
      "Epoch 10: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.20910, test_loss=-0.184\n",
      "Epoch 11: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.21689, test_loss=-0.185\n",
      "Epoch 12: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.22417, test_loss=-0.185\n",
      "Epoch 13: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.23164, test_loss=-0.183\n",
      "Epoch 14: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.23872, test_loss=-0.182\n",
      "\u001b[32m[I 2021-12-06 18:46:31,052]\u001b[0m Trial 4 finished with value: -0.13327695429325104 and parameters: {'lr': 0.0005773122689378535, 'hidden_channels': 8, 'kernel_size': 10, 'risk_aversion': 30.45227482982692, 'transaction_cost': 0.04092226449837065, 'min_weight': 1.7552579555535352e-05, 'max_weight': 0.21598052908487225}. Best is trial 2 with value: -0.13508586585521698.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:22<00:00,  2.05s/it, loss=-0.09721, test_loss=-0.1186\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.09681, test_loss=-0.1192\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.09720, test_loss=-0.1194\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.09758, test_loss=-0.1198\n",
      "Epoch 4: 100%|█| 11/11 [00:22<00:00,  2.05s/it, loss=-0.09877, test_loss=-0.1201\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.16s/it, loss=-0.09944, test_loss=-0.1203\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.21s/it, loss=-0.09973, test_loss=-0.1205\n",
      "Epoch 7: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.09991, test_loss=-0.1207\n",
      "Epoch 8: 100%|█| 11/11 [00:22<00:00,  2.04s/it, loss=-0.10022, test_loss=-0.1208\n",
      "Epoch 9: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.10083, test_loss=-0.1210\n",
      "Epoch 10: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.10143, test_loss=-0.121\n",
      "Epoch 11: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.10172, test_loss=-0.121\n",
      "Epoch 12: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.10149, test_loss=-0.121\n",
      "Epoch 13: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.10268, test_loss=-0.121\n",
      "Epoch 14: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.10270, test_loss=-0.121\n",
      "Epoch 0: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.16463, test_loss=-0.1698\n",
      "Epoch 1: 100%|█| 11/11 [00:27<00:00,  2.50s/it, loss=-0.16607, test_loss=-0.1699\n",
      "Epoch 2: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.16651, test_loss=-0.1700\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.16711, test_loss=-0.1701\n",
      "Epoch 4: 100%|█| 11/11 [00:29<00:00,  2.72s/it, loss=-0.16716, test_loss=-0.1701\n",
      "Epoch 5: 100%|█| 11/11 [00:28<00:00,  2.61s/it, loss=-0.16725, test_loss=-0.1701\n",
      "Epoch 6: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.16811, test_loss=-0.1701\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.16790, test_loss=-0.1702\n",
      "Epoch 8: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.16843, test_loss=-0.1702\n",
      "Epoch 9: 100%|█| 11/11 [00:28<00:00,  2.63s/it, loss=-0.16871, test_loss=-0.1702\n",
      "Epoch 10: 100%|█| 11/11 [00:27<00:00,  2.51s/it, loss=-0.16818, test_loss=-0.170\n",
      "Epoch 11: 100%|█| 11/11 [00:27<00:00,  2.52s/it, loss=-0.16931, test_loss=-0.170\n",
      "Epoch 12: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.16965, test_loss=-0.170\n",
      "Epoch 13: 100%|█| 11/11 [00:27<00:00,  2.47s/it, loss=-0.17011, test_loss=-0.170\n",
      "Epoch 14: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.17016, test_loss=-0.170\n",
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.13513, test_loss=-0.0950\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.13639, test_loss=-0.0953\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.13681, test_loss=-0.0954\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.13738, test_loss=-0.0956\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.13808, test_loss=-0.0957\n",
      "Epoch 5: 100%|█| 11/11 [00:26<00:00,  2.40s/it, loss=-0.13854, test_loss=-0.0960\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.13908, test_loss=-0.0961\n",
      "Epoch 7: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.13895, test_loss=-0.0962\n",
      "Epoch 8: 100%|█| 11/11 [00:27<00:00,  2.52s/it, loss=-0.13984, test_loss=-0.0964\n",
      "Epoch 9: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.14030, test_loss=-0.0965\n",
      "Epoch 10: 100%|█| 11/11 [00:24<00:00,  2.18s/it, loss=-0.14039, test_loss=-0.096\n",
      "Epoch 11: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.14099, test_loss=-0.096\n",
      "Epoch 12: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.14162, test_loss=-0.096\n",
      "Epoch 13: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.14156, test_loss=-0.097\n",
      "Epoch 14: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.14197, test_loss=-0.097\n",
      "Epoch 0: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.06539, test_loss=-0.1514\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.06546, test_loss=-0.1515\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.06608, test_loss=-0.1516\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.06691, test_loss=-0.1516\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.14s/it, loss=-0.06805, test_loss=-0.1517\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.06891, test_loss=-0.1517\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.06987, test_loss=-0.1517\n",
      "Epoch 7: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.07109, test_loss=-0.1518\n",
      "Epoch 8: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.07211, test_loss=-0.1518\n",
      "Epoch 9: 100%|█| 11/11 [00:23<00:00,  2.16s/it, loss=-0.07235, test_loss=-0.1519\n",
      "Epoch 10: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.07296, test_loss=-0.152\n",
      "Epoch 11: 100%|█| 11/11 [00:25<00:00,  2.27s/it, loss=-0.07327, test_loss=-0.152\n",
      "Epoch 12: 100%|█| 11/11 [00:26<00:00,  2.36s/it, loss=-0.07435, test_loss=-0.152\n",
      "Epoch 13: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.07523, test_loss=-0.152\n",
      "Epoch 14: 100%|█| 11/11 [00:26<00:00,  2.38s/it, loss=-0.07562, test_loss=-0.152\n",
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.22032, test_loss=-0.1318\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.22014, test_loss=-0.1320\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.33s/it, loss=-0.21989, test_loss=-0.1321\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.21976, test_loss=-0.1322\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.22018, test_loss=-0.1324\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.22081, test_loss=-0.1326\n",
      "Epoch 6: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.22116, test_loss=-0.1327\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.22151, test_loss=-0.1328\n",
      "Epoch 8: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.22186, test_loss=-0.1329\n",
      "Epoch 9: 100%|█| 11/11 [00:27<00:00,  2.46s/it, loss=-0.22223, test_loss=-0.1329\n",
      "Epoch 10: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.22253, test_loss=-0.133\n",
      "Epoch 11: 100%|█| 11/11 [48:55<00:00, 266.88s/it, loss=-0.22293, test_loss=-0.13\n",
      "Epoch 12: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.22325, test_loss=-0.133\n",
      "Epoch 13: 100%|█| 11/11 [00:28<00:00,  2.61s/it, loss=-0.22352, test_loss=-0.133\n",
      "Epoch 14: 100%|█| 11/11 [00:27<00:00,  2.50s/it, loss=-0.22387, test_loss=-0.133\n",
      "\u001b[32m[I 2021-12-06 20:07:04,601]\u001b[0m Trial 5 finished with value: -0.13543006777763367 and parameters: {'lr': 0.00010403609140284569, 'hidden_channels': 7, 'kernel_size': 9, 'risk_aversion': 0.0981856245917721, 'transaction_cost': 0.12712255098358466, 'min_weight': 0.027259350442342296, 'max_weight': 0.40272615972908055}. Best is trial 5 with value: -0.13543006777763367.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  2.00s/it, loss=-0.14400, test_loss=-0.0757\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.17s/it, loss=-0.15008, test_loss=-0.0760\n",
      "Epoch 2: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.15608, test_loss=-0.0754\n",
      "Epoch 3: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.16023, test_loss=-0.0763\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.16408, test_loss=-0.0804\n",
      "Epoch 5: 100%|█| 11/11 [00:20<00:00,  1.90s/it, loss=-0.16856, test_loss=-0.0808\n",
      "Epoch 6: 100%|█| 11/11 [00:20<00:00,  1.91s/it, loss=-0.17130, test_loss=-0.0813\n",
      "Epoch 7: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.17621, test_loss=-0.0846\n",
      "Epoch 8: 100%|█| 11/11 [00:19<00:00,  1.77s/it, loss=-0.18484, test_loss=-0.0933\n",
      "Epoch 9: 100%|█| 11/11 [00:18<00:00,  1.73s/it, loss=-0.19265, test_loss=-0.1033\n",
      "Epoch 10: 100%|█| 11/11 [00:19<00:00,  1.73s/it, loss=-0.21628, test_loss=-0.107\n",
      "Epoch 11: 100%|█| 11/11 [00:18<00:00,  1.66s/it, loss=-0.22925, test_loss=-0.105\n",
      "Epoch 12: 100%|█| 11/11 [00:18<00:00,  1.64s/it, loss=-0.24279, test_loss=-0.104\n",
      "Epoch 13: 100%|█| 11/11 [00:18<00:00,  1.65s/it, loss=-0.25162, test_loss=-0.105\n",
      "Epoch 14: 100%|█| 11/11 [00:18<00:00,  1.68s/it, loss=-0.26658, test_loss=-0.105\n",
      "Epoch 0: 100%|█| 11/11 [00:22<00:00,  2.03s/it, loss=-0.18227, test_loss=-0.1576\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.18868, test_loss=-0.1582\n",
      "Epoch 2: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.19120, test_loss=-0.1598\n",
      "Epoch 3: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.19590, test_loss=-0.1606\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.19830, test_loss=-0.1621\n",
      "Epoch 5: 100%|█| 11/11 [00:20<00:00,  1.87s/it, loss=-0.20428, test_loss=-0.1637\n",
      "Epoch 6: 100%|█| 11/11 [00:20<00:00,  1.83s/it, loss=-0.21348, test_loss=-0.1633\n",
      "Epoch 7: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.22094, test_loss=-0.1627\n",
      "Epoch 8: 100%|█| 11/11 [00:19<00:00,  1.81s/it, loss=-0.22723, test_loss=-0.1620\n",
      "Epoch 9: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.24441, test_loss=-0.1633\n",
      "Epoch 10: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.25301, test_loss=-0.165\n",
      "Epoch 11: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.26210, test_loss=-0.164\n",
      "Epoch 12: 100%|█| 11/11 [00:20<00:00,  1.86s/it, loss=-0.27120, test_loss=-0.167\n",
      "Epoch 13: 100%|█| 11/11 [00:19<00:00,  1.76s/it, loss=-0.27807, test_loss=-0.166\n",
      "Epoch 14: 100%|█| 11/11 [00:19<00:00,  1.78s/it, loss=-0.28821, test_loss=-0.163\n",
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.12950, test_loss=-0.1077\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.13333, test_loss=-0.1080\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.13569, test_loss=-0.1072\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.13974, test_loss=-0.1067\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.14279, test_loss=-0.1059\n",
      "Epoch 5: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.14298, test_loss=-0.1056\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.14801, test_loss=-0.1040\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.09652, test_loss=-0.1202\n",
      "Epoch 1: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.10059, test_loss=-0.1201\n",
      "Epoch 2: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.10488, test_loss=-0.1202\n",
      "Epoch 3: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.10919, test_loss=-0.1193\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.11383, test_loss=-0.1181\n",
      "Epoch 5: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.11901, test_loss=-0.1199\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.15693, test_loss=-0.1991\n",
      "Epoch 1: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.16109, test_loss=-0.2006\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.16775, test_loss=-0.2008\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.05s/it, loss=-0.17445, test_loss=-0.2015\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.18242, test_loss=-0.2026\n",
      "Epoch 5: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.19212, test_loss=-0.2027\n",
      "Epoch 6: 100%|█| 11/11 [00:20<00:00,  1.85s/it, loss=-0.19358, test_loss=-0.2014\n",
      "Epoch 7: 100%|█| 11/11 [00:19<00:00,  1.82s/it, loss=-0.20405, test_loss=-0.2040\n",
      "Epoch 8: 100%|█| 11/11 [00:20<00:00,  1.82s/it, loss=-0.21939, test_loss=-0.2048\n",
      "Epoch 9: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.22116, test_loss=-0.2075\n",
      "Epoch 10: 100%|█| 11/11 [00:19<00:00,  1.80s/it, loss=-0.23005, test_loss=-0.207\n",
      "Epoch 11: 100%|█| 11/11 [00:19<00:00,  1.80s/it, loss=-0.24102, test_loss=-0.203\n",
      "Epoch 12: 100%|█| 11/11 [00:20<00:00,  1.85s/it, loss=-0.24808, test_loss=-0.208\n",
      "Epoch 13: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.25719, test_loss=-0.205\n",
      "Epoch 14: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.26625, test_loss=-0.200\n",
      "\u001b[32m[I 2021-12-06 20:27:46,998]\u001b[0m Trial 6 finished with value: -0.14997509121894836 and parameters: {'lr': 0.0014972506254682862, 'hidden_channels': 10, 'kernel_size': 8, 'risk_aversion': 0.00027119651040450254, 'transaction_cost': 0.00028078437047290313, 'min_weight': 0.028642497538500695, 'max_weight': 0.6392841712179271}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.08659, test_loss=-0.1364\n",
      "Epoch 1: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.08661, test_loss=-0.1364\n",
      "Epoch 2: 100%|█| 11/11 [00:21<00:00,  2.00s/it, loss=-0.08575, test_loss=-0.1364\n",
      "Epoch 3: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.08599, test_loss=-0.1364\n",
      "Epoch 4: 100%|█| 11/11 [00:20<00:00,  1.87s/it, loss=-0.08589, test_loss=-0.1364\n",
      "Epoch 5: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.08585, test_loss=-0.1364\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:20<00:00,  1.85s/it, loss=-0.14064, test_loss=-0.1910\n",
      "Epoch 1: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.14103, test_loss=-0.1910\n",
      "Epoch 2: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.14084, test_loss=-0.1910\n",
      "Epoch 3: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.14091, test_loss=-0.1910\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.10s/it, loss=-0.14102, test_loss=-0.1910\n",
      "Epoch 5: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.14092, test_loss=-0.1910\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.13900, test_loss=-0.0937\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.03s/it, loss=-0.13838, test_loss=-0.0937\n",
      "Epoch 2: 100%|█| 11/11 [00:20<00:00,  1.86s/it, loss=-0.13813, test_loss=-0.0937\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.16s/it, loss=-0.13839, test_loss=-0.0937\n",
      "Epoch 4: 100%|█| 11/11 [00:20<00:00,  1.91s/it, loss=-0.13814, test_loss=-0.0937\n",
      "Epoch 5: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.13830, test_loss=-0.0937\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.98s/it, loss=-0.13823, test_loss=-0.0937\n",
      "Epoch 7: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.13870, test_loss=-0.0937\n",
      "Epoch 8: 100%|█| 11/11 [00:20<00:00,  1.91s/it, loss=-0.13810, test_loss=-0.0937\n",
      "Epoch 9: 100%|█| 11/11 [00:22<00:00,  2.06s/it, loss=-0.13842, test_loss=-0.0937\n",
      "Epoch 10: 100%|█| 11/11 [00:22<00:00,  2.03s/it, loss=-0.13829, test_loss=-0.093\n",
      "Epoch 11: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.13825, test_loss=-0.093\n",
      "Epoch 12: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.13836, test_loss=-0.093\n",
      "Epoch 13: 100%|█| 11/11 [00:21<00:00,  1.98s/it, loss=-0.13856, test_loss=-0.093\n",
      "Epoch 14: 100%|█| 11/11 [00:20<00:00,  1.86s/it, loss=-0.13788, test_loss=-0.093\n",
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.10029, test_loss=-0.1101\n",
      "Epoch 1: 100%|█| 11/11 [00:21<00:00,  1.98s/it, loss=-0.09932, test_loss=-0.1101\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.09999, test_loss=-0.1100\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.10111, test_loss=-0.1100\n",
      "Epoch 4: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.10028, test_loss=-0.1100\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.10102, test_loss=-0.1100\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.18s/it, loss=-0.14253, test_loss=-0.2047\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.14164, test_loss=-0.2047\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.14143, test_loss=-0.2047\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.14120, test_loss=-0.2048\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.14083, test_loss=-0.2048\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.14085, test_loss=-0.2048\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.14086, test_loss=-0.2048\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.14089, test_loss=-0.2048\n",
      "Epoch 8: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.14091, test_loss=-0.2048\n",
      "Epoch 9: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.14093, test_loss=-0.2048\n",
      "Epoch 10: 100%|█| 11/11 [00:26<00:00,  2.40s/it, loss=-0.14095, test_loss=-0.204\n",
      "Epoch 11: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.14096, test_loss=-0.204\n",
      "Epoch 12: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.14097, test_loss=-0.204\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.14098, test_loss=-0.204\n",
      "Epoch 14: 100%|█| 11/11 [00:26<00:00,  2.44s/it, loss=-0.14100, test_loss=-0.204\n",
      "\u001b[32m[I 2021-12-06 20:46:42,227]\u001b[0m Trial 7 finished with value: -0.13323527574539185 and parameters: {'lr': 6.921068246695678e-05, 'hidden_channels': 1, 'kernel_size': 8, 'risk_aversion': 0.0006805814234154899, 'transaction_cost': 0.001382255774119689, 'min_weight': 0.03549189778646879, 'max_weight': 0.7933909845067881}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.12262, test_loss=-0.0947\n",
      "Epoch 1: 100%|█| 11/11 [00:19<00:00,  1.78s/it, loss=-0.13819, test_loss=-0.1060\n",
      "Epoch 2: 100%|█| 11/11 [00:19<00:00,  1.73s/it, loss=-0.13406, test_loss=-0.1007\n",
      "Epoch 3: 100%|█| 11/11 [00:20<00:00,  1.83s/it, loss=-0.13482, test_loss=-0.1072\n",
      "Epoch 4: 100%|█| 11/11 [00:20<00:00,  1.85s/it, loss=-0.13786, test_loss=-0.1088\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.13887, test_loss=-0.1005\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.13926, test_loss=-0.1060\n",
      "Epoch 7: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.13181, test_loss=-0.1039\n",
      "Epoch 8: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.12117, test_loss=-0.1034\n",
      "Epoch 9: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.11743, test_loss=-0.1024\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.17821, test_loss=-0.1417\n",
      "Epoch 1: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.18735, test_loss=-0.1452\n",
      "Epoch 2: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.19121, test_loss=-0.1409\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.18506, test_loss=-0.1427\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.18644, test_loss=-0.1390\n",
      "Epoch 5: 100%|█| 11/11 [00:20<00:00,  1.85s/it, loss=-0.19037, test_loss=-0.1487\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.20027, test_loss=-0.1386\n",
      "Epoch 7: 100%|█| 11/11 [00:19<00:00,  1.78s/it, loss=-0.19877, test_loss=-0.1336\n",
      "Epoch 8: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.20440, test_loss=-0.1364\n",
      "Epoch 9: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.19773, test_loss=-0.1397\n",
      "Epoch 10: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.19221, test_loss=-0.140\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.14060, test_loss=-0.0837\n",
      "Epoch 1: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.14192, test_loss=-0.0833\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.03s/it, loss=-0.14106, test_loss=-0.0834\n",
      "Epoch 3: 100%|█| 11/11 [00:18<00:00,  1.66s/it, loss=-0.14130, test_loss=-0.0830\n",
      "Epoch 4: 100%|█| 11/11 [00:19<00:00,  1.73s/it, loss=-0.14651, test_loss=-0.0839\n",
      "Epoch 5: 100%|█| 11/11 [00:18<00:00,  1.72s/it, loss=-0.14647, test_loss=-0.0811\n",
      "Epoch 6: 100%|█| 11/11 [00:18<00:00,  1.70s/it, loss=-0.14921, test_loss=-0.0853\n",
      "Epoch 7: 100%|█| 11/11 [00:18<00:00,  1.66s/it, loss=-0.15698, test_loss=-0.0827\n",
      "Epoch 8: 100%|█| 11/11 [00:18<00:00,  1.70s/it, loss=-0.15685, test_loss=-0.0857\n",
      "Epoch 9: 100%|█| 11/11 [00:19<00:00,  1.74s/it, loss=-0.16116, test_loss=-0.0836\n",
      "Epoch 10: 100%|█| 11/11 [00:19<00:00,  1.76s/it, loss=-0.15911, test_loss=-0.086\n",
      "Epoch 11: 100%|█| 11/11 [00:24<00:00,  2.21s/it, loss=-0.15575, test_loss=-0.087\n",
      "Epoch 12: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.16233, test_loss=-0.080\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.16459, test_loss=-0.082\n",
      "Epoch 14: 100%|█| 11/11 [00:20<00:00,  1.90s/it, loss=-0.17090, test_loss=-0.087\n",
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.10048, test_loss=-0.1016\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.11s/it, loss=-0.10764, test_loss=-0.1052\n",
      "Epoch 2: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.11358, test_loss=-0.0997\n",
      "Epoch 3: 100%|█| 11/11 [00:20<00:00,  1.87s/it, loss=-0.11042, test_loss=-0.1009\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  2.00s/it, loss=-0.11694, test_loss=-0.1110\n",
      "Epoch 5: 100%|█| 11/11 [00:21<00:00,  2.00s/it, loss=-0.12148, test_loss=-0.1122\n",
      "Epoch 6: 100%|█| 11/11 [00:19<00:00,  1.80s/it, loss=-0.11774, test_loss=-0.1081\n",
      "Epoch 7: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.12256, test_loss=-0.1101\n",
      "Epoch 8: 100%|█| 11/11 [00:20<00:00,  1.86s/it, loss=-0.12646, test_loss=-0.1136\n",
      "Epoch 9: 100%|█| 11/11 [00:20<00:00,  1.90s/it, loss=-0.13215, test_loss=-0.1127\n",
      "Epoch 10: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.13794, test_loss=-0.113\n",
      "Epoch 11: 100%|█| 11/11 [00:20<00:00,  1.83s/it, loss=-0.14301, test_loss=-0.113\n",
      "Epoch 12: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.13934, test_loss=-0.110\n",
      "Epoch 13: 100%|█| 11/11 [00:20<00:00,  1.90s/it, loss=-0.13310, test_loss=-0.119\n",
      "Epoch 14: 100%|█| 11/11 [00:20<00:00,  1.90s/it, loss=-0.13861, test_loss=-0.117\n",
      "Epoch 0: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.16896, test_loss=-0.1520\n",
      "Epoch 1: 100%|█| 11/11 [00:19<00:00,  1.76s/it, loss=-0.17600, test_loss=-0.1523\n",
      "Epoch 2: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.17960, test_loss=-0.1618\n",
      "Epoch 3: 100%|█| 11/11 [00:20<00:00,  1.85s/it, loss=-0.18424, test_loss=-0.1607\n",
      "Epoch 4: 100%|█| 11/11 [00:19<00:00,  1.75s/it, loss=-0.18574, test_loss=-0.1612\n",
      "Epoch 5: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.19032, test_loss=-0.1661\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.18619, test_loss=-0.1667\n",
      "Epoch 7: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.18267, test_loss=-0.1661\n",
      "Epoch 8: 100%|█| 11/11 [00:22<00:00,  2.00s/it, loss=-0.17856, test_loss=-0.1699\n",
      "Epoch 9: 100%|█| 11/11 [00:22<00:00,  2.01s/it, loss=-0.17828, test_loss=-0.1655\n",
      "Epoch 10: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.17805, test_loss=-0.165\n",
      "Epoch 11: 100%|█| 11/11 [00:22<00:00,  2.03s/it, loss=-0.17860, test_loss=-0.163\n",
      "Epoch 12: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.17958, test_loss=-0.160\n",
      "Epoch 13: 100%|█| 11/11 [00:19<00:00,  1.80s/it, loss=-0.17871, test_loss=-0.162\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-06 21:10:50,888]\u001b[0m Trial 8 finished with value: -0.1301378309726715 and parameters: {'lr': 0.017563633610287857, 'hidden_channels': 14, 'kernel_size': 12, 'risk_aversion': 0.0020277982458225, 'transaction_cost': 3.6665335496631475e-05, 'min_weight': 0.04712992280446815, 'max_weight': 0.7577086653380045}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.26s/it, loss=-0.13990, test_loss=-0.0816\n",
      "Epoch 1: 100%|█| 11/11 [00:25<00:00,  2.27s/it, loss=-0.13644, test_loss=-0.0715\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.14352, test_loss=-0.0772\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.15580, test_loss=-0.0837\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.16965, test_loss=-0.0905\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.16854, test_loss=-0.0906\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.17450, test_loss=-0.0913\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.18907, test_loss=-0.0834\n",
      "Epoch 8: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.16879, test_loss=-0.0968\n",
      "Epoch 9: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.17531, test_loss=-0.0854\n",
      "Epoch 10: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.17805, test_loss=-0.069\n",
      "Epoch 11: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.17308, test_loss=-0.064\n",
      "Epoch 12: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.18715, test_loss=-0.075\n",
      "Epoch 13: 100%|█| 11/11 [00:27<00:00,  2.49s/it, loss=-0.22201, test_loss=-0.074\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.18476, test_loss=-0.1448\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.38s/it, loss=-0.19531, test_loss=-0.1500\n",
      "Epoch 2: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.21572, test_loss=-0.1588\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.18s/it, loss=-0.18482, test_loss=-0.1294\n",
      "Epoch 4: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.18347, test_loss=-0.1440\n",
      "Epoch 5: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.19598, test_loss=-0.1446\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.20401, test_loss=-0.1522\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.20250, test_loss=-0.1448\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.07949, test_loss=-0.1593\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.40s/it, loss=-0.09259, test_loss=-0.1734\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.11469, test_loss=-0.1719\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.11014, test_loss=-0.1306\n",
      "Epoch 4: 100%|█| 11/11 [00:27<00:00,  2.52s/it, loss=-0.09737, test_loss=-0.1385\n",
      "Epoch 5: 100%|█| 11/11 [00:28<00:00,  2.56s/it, loss=-0.09229, test_loss=-0.1392\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.36s/it, loss=-0.10154, test_loss=-0.1352\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.10313, test_loss=-0.1119\n",
      "Epoch 1: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.12023, test_loss=-0.1337\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.10639, test_loss=-0.1214\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.10514, test_loss=-0.1153\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.11197, test_loss=-0.1096\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.33s/it, loss=-0.11457, test_loss=-0.1208\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.12004, test_loss=-0.1046\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.18s/it, loss=-0.21734, test_loss=-0.1831\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.10s/it, loss=-0.23174, test_loss=-0.1689\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.03s/it, loss=-0.24440, test_loss=-0.1643\n",
      "Epoch 3: 100%|█| 11/11 [00:22<00:00,  2.02s/it, loss=-0.25748, test_loss=-0.1629\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.27357, test_loss=-0.1719\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.11s/it, loss=-0.28776, test_loss=-0.1764\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-06 21:28:57,122]\u001b[0m Trial 9 finished with value: -0.11505147069692612 and parameters: {'lr': 0.02709576597877566, 'hidden_channels': 11, 'kernel_size': 11, 'risk_aversion': 151.8228755936592, 'transaction_cost': 6.52878676588106e-05, 'min_weight': 0.006364209445642233, 'max_weight': 0.18015114618492045}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.13747, test_loss=-0.0862\n",
      "Epoch 1: 100%|█| 11/11 [00:27<00:00,  2.49s/it, loss=-0.13404, test_loss=-0.0871\n",
      "Epoch 2: 100%|█| 11/11 [00:29<00:00,  2.70s/it, loss=-0.13621, test_loss=-0.0885\n",
      "Epoch 3: 100%|█| 11/11 [00:29<00:00,  2.67s/it, loss=-0.13787, test_loss=-0.0880\n",
      "Epoch 4: 100%|█| 11/11 [00:28<00:00,  2.59s/it, loss=-0.13804, test_loss=-0.0886\n",
      "Epoch 5: 100%|█| 11/11 [00:28<00:00,  2.58s/it, loss=-0.13803, test_loss=-0.0885\n",
      "Epoch 6: 100%|█| 11/11 [00:29<00:00,  2.71s/it, loss=-0.13766, test_loss=-0.0883\n",
      "Epoch 7: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.13826, test_loss=-0.0880\n",
      "Epoch 8: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.13837, test_loss=-0.0889\n",
      "Epoch 9: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.13750, test_loss=-0.0889\n",
      "Epoch 10: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.13771, test_loss=-0.087\n",
      "Epoch 11: 100%|█| 11/11 [00:27<00:00,  2.48s/it, loss=-0.13775, test_loss=-0.087\n",
      "Epoch 12: 100%|█| 11/11 [00:30<00:00,  2.81s/it, loss=-0.13798, test_loss=-0.087\n",
      "Epoch 13: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.13822, test_loss=-0.088\n",
      "Epoch 14: 100%|█| 11/11 [00:29<00:00,  2.69s/it, loss=-0.13672, test_loss=-0.088\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.18416, test_loss=-0.1369\n",
      "Epoch 1: 100%|█| 11/11 [00:25<00:00,  2.27s/it, loss=-0.18515, test_loss=-0.1381\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.18452, test_loss=-0.1368\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.18489, test_loss=-0.1377\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.18628, test_loss=-0.1368\n",
      "Epoch 5: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.18695, test_loss=-0.1382\n",
      "Epoch 6: 100%|█| 11/11 [00:28<00:00,  2.57s/it, loss=-0.18710, test_loss=-0.1380\n",
      "Epoch 7: 100%|█| 11/11 [00:27<00:00,  2.50s/it, loss=-0.18693, test_loss=-0.1383\n",
      "Epoch 8: 100%|█| 11/11 [00:28<00:00,  2.56s/it, loss=-0.18646, test_loss=-0.1388\n",
      "Epoch 9: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.18710, test_loss=-0.1388\n",
      "Epoch 10: 100%|█| 11/11 [00:28<00:00,  2.57s/it, loss=-0.18731, test_loss=-0.138\n",
      "Epoch 11: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.18681, test_loss=-0.138\n",
      "Epoch 12: 100%|█| 11/11 [00:27<00:00,  2.48s/it, loss=-0.18677, test_loss=-0.138\n",
      "Epoch 13: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.18697, test_loss=-0.138\n",
      "Epoch 14: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.18715, test_loss=-0.138\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:23<00:00,  2.18s/it, loss=-0.12765, test_loss=-0.0924\n",
      "Epoch 1: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.12969, test_loss=-0.0922\n",
      "Epoch 2: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.13824, test_loss=-0.0923\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.13918, test_loss=-0.0922\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.22s/it, loss=-0.13876, test_loss=-0.0925\n",
      "Epoch 5: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.13811, test_loss=-0.0922\n",
      "Epoch 6: 100%|█| 11/11 [00:27<00:00,  2.48s/it, loss=-0.13869, test_loss=-0.0923\n",
      "Epoch 7: 100%|█| 11/11 [00:22<00:00,  2.07s/it, loss=-0.13848, test_loss=-0.0924\n",
      "Epoch 8: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.13818, test_loss=-0.0925\n",
      "Epoch 9: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.13843, test_loss=-0.0924\n",
      "Epoch 10: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.13863, test_loss=-0.092\n",
      "Epoch 11: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.13862, test_loss=-0.092\n",
      "Epoch 12: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.13801, test_loss=-0.092\n",
      "Epoch 13: 100%|█| 11/11 [00:22<00:00,  2.05s/it, loss=-0.13756, test_loss=-0.092\n",
      "Epoch 14: 100%|█| 11/11 [00:21<00:00,  1.98s/it, loss=-0.13875, test_loss=-0.092\n",
      "Epoch 0: 100%|█| 11/11 [00:20<00:00,  1.87s/it, loss=-0.10303, test_loss=-0.1059\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.09s/it, loss=-0.11252, test_loss=-0.1079\n",
      "Epoch 2: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.11142, test_loss=-0.1086\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.11178, test_loss=-0.1083\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.33s/it, loss=-0.11212, test_loss=-0.1086\n",
      "Epoch 5: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.11305, test_loss=-0.1087\n",
      "Epoch 6: 100%|█| 11/11 [00:27<00:00,  2.46s/it, loss=-0.11355, test_loss=-0.1082\n",
      "Epoch 7: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.11457, test_loss=-0.1086\n",
      "Epoch 8: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.11424, test_loss=-0.1081\n",
      "Epoch 9: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.11409, test_loss=-0.1086\n",
      "Epoch 10: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.11370, test_loss=-0.108\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.18388, test_loss=-0.1596\n",
      "Epoch 1: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.18598, test_loss=-0.1590\n",
      "Epoch 2: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.18319, test_loss=-0.1596\n",
      "Epoch 3: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.18479, test_loss=-0.1579\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.18s/it, loss=-0.19014, test_loss=-0.1678\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.18642, test_loss=-0.1657\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.18977, test_loss=-0.1660\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.18059, test_loss=-0.1633\n",
      "Epoch 8: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.18943, test_loss=-0.1594\n",
      "Epoch 9: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.17735, test_loss=-0.1571\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-06 21:57:49,736]\u001b[0m Trial 10 finished with value: -0.12814997136592865 and parameters: {'lr': 0.08386713195445937, 'hidden_channels': 20, 'kernel_size': 5, 'risk_aversion': 0.41295699797833485, 'transaction_cost': 0.004705195935518094, 'min_weight': 0.04207481220878362, 'max_weight': 0.9382552334683933}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.94s/it, loss=-0.10694, test_loss=-0.1095\n",
      "Epoch 1: 100%|█| 11/11 [00:21<00:00,  1.96s/it, loss=-0.10995, test_loss=-0.1097\n",
      "Epoch 2: 100%|█| 11/11 [00:22<00:00,  2.00s/it, loss=-0.11035, test_loss=-0.1098\n",
      "Epoch 3: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.11105, test_loss=-0.1099\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.11164, test_loss=-0.1101\n",
      "Epoch 5: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.11285, test_loss=-0.1102\n",
      "Epoch 6: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.11303, test_loss=-0.1104\n",
      "Epoch 7: 100%|█| 11/11 [00:20<00:00,  1.89s/it, loss=-0.11421, test_loss=-0.1106\n",
      "Epoch 8: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.11489, test_loss=-0.1107\n",
      "Epoch 9: 100%|█| 11/11 [00:21<00:00,  1.91s/it, loss=-0.11556, test_loss=-0.1108\n",
      "Epoch 10: 100%|█| 11/11 [00:20<00:00,  1.90s/it, loss=-0.11588, test_loss=-0.110\n",
      "Epoch 11: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.11704, test_loss=-0.111\n",
      "Epoch 12: 100%|█| 11/11 [00:21<00:00,  1.93s/it, loss=-0.11701, test_loss=-0.111\n",
      "Epoch 13: 100%|█| 11/11 [00:20<00:00,  1.90s/it, loss=-0.11767, test_loss=-0.111\n",
      "Epoch 14: 100%|█| 11/11 [00:20<00:00,  1.88s/it, loss=-0.11830, test_loss=-0.111\n",
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.92s/it, loss=-0.14345, test_loss=-0.1961\n",
      "Epoch 1: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.14406, test_loss=-0.1961\n",
      "Epoch 2: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.14476, test_loss=-0.1960\n",
      "Epoch 3: 100%|█| 11/11 [00:21<00:00,  1.99s/it, loss=-0.14494, test_loss=-0.1960\n",
      "Epoch 4: 100%|█| 11/11 [00:21<00:00,  1.97s/it, loss=-0.14541, test_loss=-0.1959\n",
      "Epoch 5: 100%|█| 11/11 [1:00:17<00:00, 328.90s/it, loss=-0.14572, test_loss=-0.1\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:21<00:00,  1.98s/it, loss=-0.08697, test_loss=-0.1447\n",
      "Epoch 1: 100%|█| 11/11 [00:22<00:00,  2.03s/it, loss=-0.08753, test_loss=-0.1453\n",
      "Epoch 2: 100%|█| 11/11 [00:21<00:00,  1.95s/it, loss=-0.08757, test_loss=-0.1458\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.08943, test_loss=-0.1459\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.19s/it, loss=-0.08972, test_loss=-0.1461\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.08997, test_loss=-0.1462\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.09075, test_loss=-0.1463\n",
      "Epoch 7: 100%|█| 11/11 [00:26<00:00,  2.38s/it, loss=-0.09077, test_loss=-0.1465\n",
      "Epoch 8: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.09132, test_loss=-0.1465\n",
      "Epoch 9: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.09156, test_loss=-0.1464\n",
      "Epoch 10: 100%|█| 11/11 [00:27<00:00,  2.46s/it, loss=-0.09164, test_loss=-0.146\n",
      "Epoch 11: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.09178, test_loss=-0.146\n",
      "Epoch 12: 100%|█| 11/11 [00:27<00:00,  2.49s/it, loss=-0.09275, test_loss=-0.146\n",
      "Epoch 13: 100%|█| 11/11 [00:27<00:00,  2.48s/it, loss=-0.09310, test_loss=-0.146\n",
      "Epoch 14: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.09318, test_loss=-0.146\n",
      "Epoch 0: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.08994, test_loss=-0.1243\n",
      "Epoch 1: 100%|█| 11/11 [00:28<00:00,  2.57s/it, loss=-0.09026, test_loss=-0.1243\n",
      "Epoch 2: 100%|█| 11/11 [00:27<00:00,  2.51s/it, loss=-0.09119, test_loss=-0.1243\n",
      "Epoch 3: 100%|█| 11/11 [00:28<00:00,  2.57s/it, loss=-0.09176, test_loss=-0.1244\n",
      "Epoch 4: 100%|█| 11/11 [00:27<00:00,  2.48s/it, loss=-0.09189, test_loss=-0.1245\n",
      "Epoch 5: 100%|█| 11/11 [00:27<00:00,  2.52s/it, loss=-0.09280, test_loss=-0.1246\n",
      "Epoch 6: 100%|█| 11/11 [00:28<00:00,  2.56s/it, loss=-0.09316, test_loss=-0.1246\n",
      "Epoch 7: 100%|█| 11/11 [00:28<00:00,  2.56s/it, loss=-0.09373, test_loss=-0.1246\n",
      "Epoch 8: 100%|█| 11/11 [00:28<00:00,  2.61s/it, loss=-0.09412, test_loss=-0.1247\n",
      "Epoch 9: 100%|█| 11/11 [00:28<00:00,  2.55s/it, loss=-0.09503, test_loss=-0.1246\n",
      "Epoch 10: 100%|█| 11/11 [00:28<00:00,  2.62s/it, loss=-0.09496, test_loss=-0.124\n",
      "Epoch 11: 100%|█| 11/11 [00:28<00:00,  2.58s/it, loss=-0.09547, test_loss=-0.124\n",
      "Epoch 12: 100%|█| 11/11 [00:29<00:00,  2.66s/it, loss=-0.09601, test_loss=-0.124\n",
      "Epoch 13: 100%|█| 11/11 [00:29<00:00,  2.66s/it, loss=-0.09614, test_loss=-0.124\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:29<00:00,  2.67s/it, loss=-0.19374, test_loss=-0.1615\n",
      "Epoch 1: 100%|█| 11/11 [00:28<00:00,  2.62s/it, loss=-0.19349, test_loss=-0.1615\n",
      "Epoch 2: 100%|█| 11/11 [00:29<00:00,  2.67s/it, loss=-0.19387, test_loss=-0.1615\n",
      "Epoch 3: 100%|█| 11/11 [00:29<00:00,  2.69s/it, loss=-0.19427, test_loss=-0.1615\n",
      "Epoch 4: 100%|█| 11/11 [00:29<00:00,  2.70s/it, loss=-0.19466, test_loss=-0.1615\n",
      "Epoch 5: 100%|█| 11/11 [00:28<00:00,  2.62s/it, loss=-0.19494, test_loss=-0.1616\n",
      "Epoch 6: 100%|█| 11/11 [00:29<00:00,  2.66s/it, loss=-0.19544, test_loss=-0.1616\n",
      "Epoch 7: 100%|█| 11/11 [00:29<00:00,  2.64s/it, loss=-0.19579, test_loss=-0.1615\n",
      "Epoch 8: 100%|█| 11/11 [00:29<00:00,  2.72s/it, loss=-0.19616, test_loss=-0.1615\n",
      "Epoch 9: 100%|█| 11/11 [00:29<00:00,  2.73s/it, loss=-0.19640, test_loss=-0.1615\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.19666, test_loss=-0.161\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-06 23:24:03,152]\u001b[0m Trial 11 finished with value: -0.13451625406742096 and parameters: {'lr': 0.0005179609821556669, 'hidden_channels': 3, 'kernel_size': 6, 'risk_aversion': 0.0958847417102158, 'transaction_cost': 0.0005857513375272726, 'min_weight': 0.023359350060434592, 'max_weight': 0.573959844426073}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:28<00:00,  2.63s/it, loss=-0.10355, test_loss=-0.1142\n",
      "Epoch 1: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.10526, test_loss=-0.1157\n",
      "Epoch 2: 100%|█| 11/11 [00:28<00:00,  2.60s/it, loss=-0.10748, test_loss=-0.1158\n",
      "Epoch 3: 100%|█| 11/11 [00:30<00:00,  2.73s/it, loss=-0.10944, test_loss=-0.1153\n",
      "Epoch 4: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.11062, test_loss=-0.1148\n",
      "Epoch 5: 100%|█| 11/11 [00:30<00:00,  2.75s/it, loss=-0.11235, test_loss=-0.1144\n",
      "Epoch 6: 100%|█| 11/11 [00:29<00:00,  2.66s/it, loss=-0.11267, test_loss=-0.1146\n",
      "Epoch 7: 100%|█| 11/11 [00:29<00:00,  2.72s/it, loss=-0.11511, test_loss=-0.1138\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.12984, test_loss=-0.2011\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.13239, test_loss=-0.2014\n",
      "Epoch 2: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.13490, test_loss=-0.2017\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.13776, test_loss=-0.2021\n",
      "Epoch 4: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.13943, test_loss=-0.2023\n",
      "Epoch 5: 100%|█| 11/11 [00:30<00:00,  2.81s/it, loss=-0.13981, test_loss=-0.2026\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.14120, test_loss=-0.2029\n",
      "Epoch 7: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.14222, test_loss=-0.2031\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.14347, test_loss=-0.2035\n",
      "Epoch 9: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.14325, test_loss=-0.2037\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.14494, test_loss=-0.204\n",
      "Epoch 11: 100%|█| 11/11 [00:30<00:00,  2.73s/it, loss=-0.14578, test_loss=-0.204\n",
      "Epoch 12: 100%|█| 11/11 [00:30<00:00,  2.81s/it, loss=-0.14649, test_loss=-0.204\n",
      "Epoch 13: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.14760, test_loss=-0.204\n",
      "Epoch 14: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.14926, test_loss=-0.204\n",
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.76s/it, loss=-0.13605, test_loss=-0.0956\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.13867, test_loss=-0.0960\n",
      "Epoch 2: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.14034, test_loss=-0.0961\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.14287, test_loss=-0.0962\n",
      "Epoch 4: 100%|█| 11/11 [00:30<00:00,  2.75s/it, loss=-0.14360, test_loss=-0.0962\n",
      "Epoch 5: 100%|█| 11/11 [00:31<00:00,  2.82s/it, loss=-0.14538, test_loss=-0.0962\n",
      "Epoch 6: 100%|█| 11/11 [00:30<00:00,  2.74s/it, loss=-0.14655, test_loss=-0.0961\n",
      "Epoch 7: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.14740, test_loss=-0.0960\n",
      "Epoch 8: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.14869, test_loss=-0.0958\n",
      "Epoch 9: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.14990, test_loss=-0.0958\n",
      "Epoch 10: 100%|█| 11/11 [00:29<00:00,  2.71s/it, loss=-0.15047, test_loss=-0.095\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.81s/it, loss=-0.10081, test_loss=-0.1083\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.82s/it, loss=-0.10392, test_loss=-0.1090\n",
      "Epoch 2: 100%|█| 11/11 [00:30<00:00,  2.81s/it, loss=-0.10726, test_loss=-0.1090\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.11134, test_loss=-0.1094\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.11416, test_loss=-0.1098\n",
      "Epoch 5: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.11584, test_loss=-0.1102\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.11825, test_loss=-0.1103\n",
      "Epoch 7: 100%|█| 11/11 [00:33<00:00,  3.07s/it, loss=-0.12056, test_loss=-0.1107\n",
      "Epoch 8: 100%|█| 11/11 [00:32<00:00,  2.97s/it, loss=-0.12159, test_loss=-0.1110\n",
      "Epoch 9: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.12355, test_loss=-0.1113\n",
      "Epoch 10: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.12514, test_loss=-0.111\n",
      "Epoch 11: 100%|█| 11/11 [00:30<00:00,  2.82s/it, loss=-0.12655, test_loss=-0.112\n",
      "Epoch 12: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.12831, test_loss=-0.112\n",
      "Epoch 13: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.13002, test_loss=-0.112\n",
      "Epoch 14: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.13094, test_loss=-0.113\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.16585, test_loss=-0.1840\n",
      "Epoch 1: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.17004, test_loss=-0.1845\n",
      "Epoch 2: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.17362, test_loss=-0.1847\n",
      "Epoch 3: 100%|█| 11/11 [00:32<00:00,  2.99s/it, loss=-0.17580, test_loss=-0.1851\n",
      "Epoch 4: 100%|█| 11/11 [00:31<00:00,  2.91s/it, loss=-0.17766, test_loss=-0.1857\n",
      "Epoch 5: 100%|█| 11/11 [00:33<00:00,  3.04s/it, loss=-0.17972, test_loss=-0.1863\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.18166, test_loss=-0.1865\n",
      "Epoch 7: 100%|█| 11/11 [00:33<00:00,  3.08s/it, loss=-0.18421, test_loss=-0.1867\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.18676, test_loss=-0.1870\n",
      "Epoch 9: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.18864, test_loss=-0.1874\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.19048, test_loss=-0.187\n",
      "Epoch 11: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.19176, test_loss=-0.187\n",
      "Epoch 12: 100%|█| 11/11 [00:34<00:00,  3.10s/it, loss=-0.19299, test_loss=-0.188\n",
      "Epoch 13: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.19437, test_loss=-0.188\n",
      "Epoch 14: 100%|█| 11/11 [00:33<00:00,  3.06s/it, loss=-0.19586, test_loss=-0.188\n",
      "\u001b[32m[I 2021-12-06 23:58:00,909]\u001b[0m Trial 12 finished with value: -0.136459618806839 and parameters: {'lr': 0.00024412219851523636, 'hidden_channels': 12, 'kernel_size': 8, 'risk_aversion': 0.08847656814205479, 'transaction_cost': 0.008754940891120874, 'min_weight': 0.030601587096098445, 'max_weight': 0.5735143219158274}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.09095, test_loss=-0.1319\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.09868, test_loss=-0.1383\n",
      "Epoch 2: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.11493, test_loss=-0.1537\n",
      "Epoch 3: 100%|█| 11/11 [00:30<00:00,  2.77s/it, loss=-0.12999, test_loss=-0.1542\n",
      "Epoch 4: 100%|█| 11/11 [00:28<00:00,  2.62s/it, loss=-0.13185, test_loss=-0.1506\n",
      "Epoch 5: 100%|█| 11/11 [00:28<00:00,  2.63s/it, loss=-0.14178, test_loss=-0.1424\n",
      "Epoch 6: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.14623, test_loss=-0.1360\n",
      "Epoch 7: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.16536, test_loss=-0.1385\n",
      "Epoch 8: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.18609, test_loss=-0.1331\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.20550, test_loss=-0.1275\n",
      "Epoch 1: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.20993, test_loss=-0.1302\n",
      "Epoch 2: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.21307, test_loss=-0.1305\n",
      "Epoch 3: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.21484, test_loss=-0.1301\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.21787, test_loss=-0.1305\n",
      "Epoch 5: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.21847, test_loss=-0.1339\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.91s/it, loss=-0.21963, test_loss=-0.1344\n",
      "Epoch 7: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.22392, test_loss=-0.1329\n",
      "Epoch 8: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.22764, test_loss=-0.1356\n",
      "Epoch 9: 100%|█| 11/11 [00:29<00:00,  2.70s/it, loss=-0.23437, test_loss=-0.1388\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.24329, test_loss=-0.134\n",
      "Epoch 11: 100%|█| 11/11 [00:29<00:00,  2.70s/it, loss=-0.25547, test_loss=-0.137\n",
      "Epoch 12: 100%|█| 11/11 [00:29<00:00,  2.72s/it, loss=-0.27083, test_loss=-0.139\n",
      "Epoch 13: 100%|█| 11/11 [00:29<00:00,  2.70s/it, loss=-0.28079, test_loss=-0.137\n",
      "Epoch 14: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.28829, test_loss=-0.136\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.12813, test_loss=-0.1028\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.97s/it, loss=-0.13157, test_loss=-0.1012\n",
      "Epoch 2: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.14027, test_loss=-0.1021\n",
      "Epoch 3: 100%|█| 11/11 [00:30<00:00,  2.77s/it, loss=-0.14839, test_loss=-0.1015\n",
      "Epoch 4: 100%|█| 11/11 [00:29<00:00,  2.71s/it, loss=-0.15384, test_loss=-0.1064\n",
      "Epoch 5: 100%|█| 11/11 [00:29<00:00,  2.72s/it, loss=-0.16184, test_loss=-0.1105\n",
      "Epoch 6: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.17573, test_loss=-0.1152\n",
      "Epoch 7: 100%|█| 11/11 [00:26<00:00,  2.41s/it, loss=-0.19394, test_loss=-0.1206\n",
      "Epoch 8: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.20841, test_loss=-0.1245\n",
      "Epoch 9: 100%|█| 11/11 [00:27<00:00,  2.47s/it, loss=-0.21484, test_loss=-0.1189\n",
      "Epoch 10: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.23275, test_loss=-0.114\n",
      "Epoch 11: 100%|█| 11/11 [00:26<00:00,  2.39s/it, loss=-0.23694, test_loss=-0.111\n",
      "Epoch 12: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.25237, test_loss=-0.108\n",
      "Epoch 13: 100%|█| 11/11 [00:24<00:00,  2.21s/it, loss=-0.26311, test_loss=-0.107\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.10480, test_loss=-0.1093\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.11211, test_loss=-0.1127\n",
      "Epoch 2: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.12663, test_loss=-0.1157\n",
      "Epoch 3: 100%|█| 11/11 [00:28<00:00,  2.60s/it, loss=-0.13979, test_loss=-0.1175\n",
      "Epoch 4: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.15894, test_loss=-0.1214\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.33s/it, loss=-0.17549, test_loss=-0.1231\n",
      "Epoch 6: 100%|█| 11/11 [00:23<00:00,  2.18s/it, loss=-0.19482, test_loss=-0.1351\n",
      "Epoch 7: 100%|█| 11/11 [00:24<00:00,  2.24s/it, loss=-0.20324, test_loss=-0.1391\n",
      "Epoch 8: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.21549, test_loss=-0.1387\n",
      "Epoch 9: 100%|█| 11/11 [00:23<00:00,  2.13s/it, loss=-0.22772, test_loss=-0.1360\n",
      "Epoch 10: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.23565, test_loss=-0.137\n",
      "Epoch 11: 100%|█| 11/11 [00:22<00:00,  2.08s/it, loss=-0.24651, test_loss=-0.138\n",
      "Epoch 12: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.25256, test_loss=-0.142\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.26318, test_loss=-0.144\n",
      "Epoch 14: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.27819, test_loss=-0.142\n",
      "Epoch 0: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.18015, test_loss=-0.1669\n",
      "Epoch 1: 100%|█| 11/11 [00:33<00:00,  3.04s/it, loss=-0.18837, test_loss=-0.1690\n",
      "Epoch 2: 100%|█| 11/11 [00:33<00:00,  3.08s/it, loss=-0.19380, test_loss=-0.1683\n",
      "Epoch 3: 100%|█| 11/11 [00:34<00:00,  3.16s/it, loss=-0.19788, test_loss=-0.1688\n",
      "Epoch 4: 100%|█| 11/11 [00:33<00:00,  3.07s/it, loss=-0.19696, test_loss=-0.1694\n",
      "Epoch 5: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.20051, test_loss=-0.1680\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  3.00s/it, loss=-0.20402, test_loss=-0.1681\n",
      "Epoch 7: 100%|█| 11/11 [00:34<00:00,  3.11s/it, loss=-0.21026, test_loss=-0.1678\n",
      "Epoch 8: 100%|█| 11/11 [00:33<00:00,  3.08s/it, loss=-0.21121, test_loss=-0.1694\n",
      "Epoch 9: 100%|█| 11/11 [00:33<00:00,  3.09s/it, loss=-0.21602, test_loss=-0.1696\n",
      "Epoch 10: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.21897, test_loss=-0.172\n",
      "Epoch 11: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.22028, test_loss=-0.174\n",
      "Epoch 12: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.22602, test_loss=-0.174\n",
      "Epoch 13: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.22853, test_loss=-0.177\n",
      "Epoch 14: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.23198, test_loss=-0.174\n",
      "\u001b[32m[I 2021-12-07 00:31:59,410]\u001b[0m Trial 13 finished with value: -0.1348082572221756 and parameters: {'lr': 0.0019817569972691686, 'hidden_channels': 13, 'kernel_size': 7, 'risk_aversion': 2.9345538891144075e-05, 'transaction_cost': 0.006539519374160266, 'min_weight': 0.03544251474253394, 'max_weight': 0.6301961929546409}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.09535, test_loss=-0.1195\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.90s/it, loss=-0.10094, test_loss=-0.1196\n",
      "Epoch 2: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.10528, test_loss=-0.1201\n",
      "Epoch 3: 100%|█| 11/11 [00:33<00:00,  3.04s/it, loss=-0.10949, test_loss=-0.1201\n",
      "Epoch 4: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.11342, test_loss=-0.1207\n",
      "Epoch 5: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.11833, test_loss=-0.1208\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.12319, test_loss=-0.1223\n",
      "Epoch 7: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.12937, test_loss=-0.1242\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.13389, test_loss=-0.1257\n",
      "Epoch 9: 100%|█| 11/11 [00:30<00:00,  2.77s/it, loss=-0.13839, test_loss=-0.1252\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.14350, test_loss=-0.125\n",
      "Epoch 11: 100%|█| 11/11 [00:30<00:00,  2.76s/it, loss=-0.15002, test_loss=-0.125\n",
      "Epoch 12: 100%|█| 11/11 [00:30<00:00,  2.81s/it, loss=-0.15799, test_loss=-0.125\n",
      "Epoch 13: 100%|█| 11/11 [00:30<00:00,  2.76s/it, loss=-0.16383, test_loss=-0.124\n",
      "Epoch 14: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.16895, test_loss=-0.124\n",
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.75s/it, loss=-0.15541, test_loss=-0.1847\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.91s/it, loss=-0.15915, test_loss=-0.1850\n",
      "Epoch 2: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.16339, test_loss=-0.1854\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.16746, test_loss=-0.1859\n",
      "Epoch 4: 100%|█| 11/11 [00:30<00:00,  2.77s/it, loss=-0.17096, test_loss=-0.1860\n",
      "Epoch 5: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.17488, test_loss=-0.1867\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.17871, test_loss=-0.1875\n",
      "Epoch 7: 100%|█| 11/11 [00:31<00:00,  2.90s/it, loss=-0.18365, test_loss=-0.1878\n",
      "Epoch 8: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.18716, test_loss=-0.1882\n",
      "Epoch 9: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.19203, test_loss=-0.1888\n",
      "Epoch 10: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.19612, test_loss=-0.188\n",
      "Epoch 11: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.20050, test_loss=-0.189\n",
      "Epoch 12: 100%|█| 11/11 [00:30<00:00,  2.73s/it, loss=-0.20346, test_loss=-0.189\n",
      "Epoch 13: 100%|█| 11/11 [00:30<00:00,  2.77s/it, loss=-0.21015, test_loss=-0.190\n",
      "Epoch 14: 100%|█| 11/11 [00:30<00:00,  2.76s/it, loss=-0.21423, test_loss=-0.189\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.12612, test_loss=-0.1037\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.99s/it, loss=-0.13065, test_loss=-0.1045\n",
      "Epoch 2: 100%|█| 11/11 [00:31<00:00,  2.90s/it, loss=-0.13284, test_loss=-0.1046\n",
      "Epoch 3: 100%|█| 11/11 [00:33<00:00,  3.00s/it, loss=-0.13594, test_loss=-0.1035\n",
      "Epoch 4: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.13931, test_loss=-0.1033\n",
      "Epoch 5: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.14154, test_loss=-0.1031\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.14477, test_loss=-0.1028\n",
      "Epoch 7: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.14717, test_loss=-0.1027\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.09144, test_loss=-0.1210\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.09963, test_loss=-0.1222\n",
      "Epoch 2: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.10371, test_loss=-0.1223\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.10684, test_loss=-0.1231\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.11137, test_loss=-0.1230\n",
      "Epoch 5: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.11607, test_loss=-0.1239\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.12011, test_loss=-0.1250\n",
      "Epoch 7: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.12441, test_loss=-0.1254\n",
      "Epoch 8: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.13051, test_loss=-0.1253\n",
      "Epoch 9: 100%|█| 11/11 [00:30<00:00,  2.76s/it, loss=-0.13460, test_loss=-0.1264\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.13894, test_loss=-0.126\n",
      "Epoch 11: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.14333, test_loss=-0.126\n",
      "Epoch 12: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.14598, test_loss=-0.126\n",
      "Epoch 13: 100%|█| 11/11 [00:30<00:00,  2.76s/it, loss=-0.14767, test_loss=-0.126\n",
      "Epoch 14: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.15167, test_loss=-0.126\n",
      "Epoch 0: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.18609, test_loss=-0.1691\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.18907, test_loss=-0.1701\n",
      "Epoch 2: 100%|█| 11/11 [00:32<00:00,  2.97s/it, loss=-0.19298, test_loss=-0.1700\n",
      "Epoch 3: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.19668, test_loss=-0.1708\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.19947, test_loss=-0.1708\n",
      "Epoch 5: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.20333, test_loss=-0.1704\n",
      "Epoch 6: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.20746, test_loss=-0.1707\n",
      "Epoch 7: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.21024, test_loss=-0.1706\n",
      "Epoch 8: 100%|█| 11/11 [00:33<00:00,  3.02s/it, loss=-0.21476, test_loss=-0.1711\n",
      "Epoch 9: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.21818, test_loss=-0.1715\n",
      "Epoch 10: 100%|█| 11/11 [00:33<00:00,  3.07s/it, loss=-0.22084, test_loss=-0.171\n",
      "Epoch 11: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.22469, test_loss=-0.171\n",
      "Epoch 12: 100%|█| 11/11 [00:32<00:00,  2.95s/it, loss=-0.22650, test_loss=-0.170\n",
      "Epoch 13: 100%|█| 11/11 [00:32<00:00,  2.99s/it, loss=-0.22897, test_loss=-0.169\n",
      "Epoch 14: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.23158, test_loss=-0.170\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-07 01:08:30,054]\u001b[0m Trial 14 finished with value: -0.13341906666755676 and parameters: {'lr': 0.0002891521386576721, 'hidden_channels': 17, 'kernel_size': 8, 'risk_aversion': 0.884803653091518, 'transaction_cost': 1.2869433889512215e-05, 'min_weight': 0.020378095570391486, 'max_weight': 0.7083906579088493}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.10772, test_loss=-0.1065\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.10792, test_loss=-0.1065\n",
      "Epoch 2: 100%|█| 11/11 [00:31<00:00,  2.91s/it, loss=-0.10752, test_loss=-0.1066\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.10796, test_loss=-0.1066\n",
      "Epoch 4: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.10826, test_loss=-0.1067\n",
      "Epoch 5: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.10830, test_loss=-0.1068\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.90s/it, loss=-0.10885, test_loss=-0.1068\n",
      "Epoch 7: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.10871, test_loss=-0.1068\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.10906, test_loss=-0.1069\n",
      "Epoch 9: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.10859, test_loss=-0.1069\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.10941, test_loss=-0.107\n",
      "Epoch 11: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.10918, test_loss=-0.107\n",
      "Epoch 12: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.10939, test_loss=-0.107\n",
      "Epoch 13: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.10953, test_loss=-0.107\n",
      "Epoch 14: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.10946, test_loss=-0.107\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.12964, test_loss=-0.2000\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.12976, test_loss=-0.2000\n",
      "Epoch 2: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.12942, test_loss=-0.2001\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.12931, test_loss=-0.2001\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.95s/it, loss=-0.12953, test_loss=-0.2001\n",
      "Epoch 5: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.12945, test_loss=-0.2002\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.12945, test_loss=-0.2002\n",
      "Epoch 7: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.12967, test_loss=-0.2003\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.12983, test_loss=-0.2003\n",
      "Epoch 9: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.12988, test_loss=-0.2003\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.13031, test_loss=-0.200\n",
      "Epoch 11: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.13002, test_loss=-0.200\n",
      "Epoch 12: 100%|█| 11/11 [00:31<00:00,  2.82s/it, loss=-0.13057, test_loss=-0.200\n",
      "Epoch 13: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.13014, test_loss=-0.200\n",
      "Epoch 14: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.13031, test_loss=-0.200\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.11554, test_loss=-0.1112\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.11525, test_loss=-0.1113\n",
      "Epoch 2: 100%|█| 11/11 [00:33<00:00,  3.02s/it, loss=-0.11501, test_loss=-0.1113\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.11505, test_loss=-0.1114\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.11486, test_loss=-0.1114\n",
      "Epoch 5: 100%|█| 11/11 [00:32<00:00,  2.95s/it, loss=-0.11471, test_loss=-0.1115\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.11502, test_loss=-0.1115\n",
      "Epoch 7: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.11492, test_loss=-0.1116\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.11539, test_loss=-0.1116\n",
      "Epoch 9: 100%|█| 11/11 [00:32<00:00,  2.95s/it, loss=-0.11621, test_loss=-0.1117\n",
      "Epoch 10: 100%|█| 11/11 [00:30<00:00,  2.76s/it, loss=-0.11565, test_loss=-0.111\n",
      "Epoch 11: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.11559, test_loss=-0.111\n",
      "Epoch 12: 100%|█| 11/11 [00:30<00:00,  2.81s/it, loss=-0.11610, test_loss=-0.111\n",
      "Epoch 13: 100%|█| 11/11 [00:31<00:00,  2.91s/it, loss=-0.11632, test_loss=-0.111\n",
      "Epoch 14: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.11597, test_loss=-0.111\n",
      "Epoch 0: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.08246, test_loss=-0.1304\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.08325, test_loss=-0.1304\n",
      "Epoch 2: 100%|█| 11/11 [00:33<00:00,  3.02s/it, loss=-0.08327, test_loss=-0.1304\n",
      "Epoch 3: 100%|█| 11/11 [00:32<00:00,  2.97s/it, loss=-0.08351, test_loss=-0.1304\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.08326, test_loss=-0.1304\n",
      "Epoch 5: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.08376, test_loss=-0.1304\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.95s/it, loss=-0.08418, test_loss=-0.1305\n",
      "Epoch 7: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.08459, test_loss=-0.1305\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.08447, test_loss=-0.1305\n",
      "Epoch 9: 100%|█| 11/11 [00:33<00:00,  3.04s/it, loss=-0.08443, test_loss=-0.1305\n",
      "Epoch 10: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.08460, test_loss=-0.130\n",
      "Epoch 11: 100%|█| 11/11 [00:34<00:00,  3.10s/it, loss=-0.08491, test_loss=-0.130\n",
      "Epoch 12: 100%|█| 11/11 [00:32<00:00,  2.99s/it, loss=-0.08498, test_loss=-0.130\n",
      "Epoch 13: 100%|█| 11/11 [00:34<00:00,  3.12s/it, loss=-0.08549, test_loss=-0.130\n",
      "Epoch 14: 100%|█| 11/11 [00:34<00:00,  3.11s/it, loss=-0.08579, test_loss=-0.130\n",
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.82s/it, loss=-0.16833, test_loss=-0.1806\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.90s/it, loss=-0.16735, test_loss=-0.1806\n",
      "Epoch 2: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.16605, test_loss=-0.1807\n",
      "Epoch 3: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.16654, test_loss=-0.1807\n",
      "Epoch 4: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.16708, test_loss=-0.1807\n",
      "Epoch 5: 100%|█| 11/11 [00:31<00:00,  2.91s/it, loss=-0.16720, test_loss=-0.1807\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.16734, test_loss=-0.1807\n",
      "Epoch 7: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.16744, test_loss=-0.1807\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.16755, test_loss=-0.1807\n",
      "Epoch 9: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.16767, test_loss=-0.1807\n",
      "Epoch 10: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.16776, test_loss=-0.180\n",
      "Epoch 11: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.16788, test_loss=-0.180\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-07 01:47:20,148]\u001b[0m Trial 15 finished with value: -0.13259008526802063 and parameters: {'lr': 1.2733902194285427e-05, 'hidden_channels': 11, 'kernel_size': 6, 'risk_aversion': 0.008526605053390524, 'transaction_cost': 0.012541472855683902, 'min_weight': 0.034024502375466156, 'max_weight': 0.9135154461416377}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:28<00:00,  2.61s/it, loss=-0.10044, test_loss=-0.1285\n",
      "Epoch 1: 100%|█| 11/11 [00:26<00:00,  2.37s/it, loss=-0.14805, test_loss=-0.1226\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.18545, test_loss=-0.1329\n",
      "Epoch 3: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.20339, test_loss=-0.1392\n",
      "Epoch 4: 100%|█| 11/11 [00:24<00:00,  2.21s/it, loss=-0.24650, test_loss=-0.1362\n",
      "Epoch 5: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.20878, test_loss=-0.1226\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.27s/it, loss=-0.23668, test_loss=-0.1262\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.28s/it, loss=-0.25126, test_loss=-0.1331\n",
      "Epoch 8: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.26440, test_loss=-0.1324\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.18347, test_loss=-0.1542\n",
      "Epoch 1: 100%|█| 11/11 [00:29<00:00,  2.64s/it, loss=-0.20564, test_loss=-0.1493\n",
      "Epoch 2: 100%|█| 11/11 [00:30<00:00,  2.75s/it, loss=-0.21862, test_loss=-0.1619\n",
      "Epoch 3: 100%|█| 11/11 [00:28<00:00,  2.60s/it, loss=-0.23361, test_loss=-0.1596\n",
      "Epoch 4: 100%|█| 11/11 [00:28<00:00,  2.63s/it, loss=-0.24795, test_loss=-0.1627\n",
      "Epoch 5: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.26853, test_loss=-0.1688\n",
      "Epoch 6: 100%|█| 11/11 [00:28<00:00,  2.61s/it, loss=-0.28877, test_loss=-0.1644\n",
      "Epoch 7: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.28922, test_loss=-0.1551\n",
      "Epoch 8: 100%|█| 11/11 [00:27<00:00,  2.46s/it, loss=-0.29698, test_loss=-0.1555\n",
      "Epoch 9: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.30988, test_loss=-0.1580\n",
      "Epoch 10: 100%|█| 11/11 [00:28<00:00,  2.61s/it, loss=-0.33266, test_loss=-0.155\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.08331, test_loss=-0.1478\n",
      "Epoch 1: 100%|█| 11/11 [00:35<00:00,  3.25s/it, loss=-0.09158, test_loss=-0.1454\n",
      "Epoch 2: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.09988, test_loss=-0.1397\n",
      "Epoch 3: 100%|█| 11/11 [00:29<00:00,  2.69s/it, loss=-0.10714, test_loss=-0.1326\n",
      "Epoch 4: 100%|█| 11/11 [00:27<00:00,  2.52s/it, loss=-0.14660, test_loss=-0.1209\n",
      "Epoch 5: 100%|█| 11/11 [00:27<00:00,  2.46s/it, loss=-0.19256, test_loss=-0.1432\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.90s/it, loss=-0.14086, test_loss=-0.0829\n",
      "Epoch 1: 100%|█| 11/11 [00:29<00:00,  2.69s/it, loss=-0.16628, test_loss=-0.0847\n",
      "Epoch 2: 100%|█| 11/11 [00:29<00:00,  2.64s/it, loss=-0.18526, test_loss=-0.0823\n",
      "Epoch 3: 100%|█| 11/11 [00:28<00:00,  2.63s/it, loss=-0.19393, test_loss=-0.0868\n",
      "Epoch 4: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.20338, test_loss=-0.0908\n",
      "Epoch 5: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.20139, test_loss=-0.0926\n",
      "Epoch 6: 100%|█| 11/11 [00:28<00:00,  2.55s/it, loss=-0.20637, test_loss=-0.0794\n",
      "Epoch 7: 100%|█| 11/11 [00:27<00:00,  2.49s/it, loss=-0.20748, test_loss=-0.0936\n",
      "Epoch 8: 100%|█| 11/11 [00:28<00:00,  2.59s/it, loss=-0.23172, test_loss=-0.0925\n",
      "Epoch 9: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.24835, test_loss=-0.0906\n",
      "Epoch 10: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.25784, test_loss=-0.088\n",
      "Epoch 11: 100%|█| 11/11 [00:27<00:00,  2.46s/it, loss=-0.25909, test_loss=-0.089\n",
      "Epoch 12: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.27303, test_loss=-0.088\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.20658, test_loss=-0.1582\n",
      "Epoch 1: 100%|█| 11/11 [00:29<00:00,  2.69s/it, loss=-0.23723, test_loss=-0.1517\n",
      "Epoch 2: 100%|█| 11/11 [00:27<00:00,  2.51s/it, loss=-0.25727, test_loss=-0.1249\n",
      "Epoch 3: 100%|█| 11/11 [00:27<00:00,  2.53s/it, loss=-0.27408, test_loss=-0.1324\n",
      "Epoch 4: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.28280, test_loss=-0.1123\n",
      "Epoch 5: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.30719, test_loss=-0.0987\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-07 02:08:55,827]\u001b[0m Trial 16 finished with value: -0.12972861528396606 and parameters: {'lr': 0.0030144342654298043, 'hidden_channels': 17, 'kernel_size': 3, 'risk_aversion': 0.03137944102047879, 'transaction_cost': 0.00028673422767913663, 'min_weight': 0.015792832097549125, 'max_weight': 0.49222689000537134}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:35<00:00,  3.25s/it, loss=-0.09404, test_loss=-0.1269\n",
      "Epoch 1: 100%|█| 11/11 [00:37<00:00,  3.43s/it, loss=-0.09403, test_loss=-0.1270\n",
      "Epoch 2: 100%|█| 11/11 [00:39<00:00,  3.55s/it, loss=-0.09419, test_loss=-0.1270\n",
      "Epoch 3: 100%|█| 11/11 [00:36<00:00,  3.35s/it, loss=-0.09507, test_loss=-0.1271\n",
      "Epoch 4: 100%|█| 11/11 [00:37<00:00,  3.37s/it, loss=-0.09546, test_loss=-0.1271\n",
      "Epoch 5: 100%|█| 11/11 [00:36<00:00,  3.30s/it, loss=-0.09559, test_loss=-0.1271\n",
      "Epoch 6: 100%|█| 11/11 [00:36<00:00,  3.30s/it, loss=-0.09544, test_loss=-0.1271\n",
      "Epoch 7: 100%|█| 11/11 [00:36<00:00,  3.36s/it, loss=-0.09593, test_loss=-0.1272\n",
      "Epoch 8: 100%|█| 11/11 [00:36<00:00,  3.34s/it, loss=-0.09609, test_loss=-0.1272\n",
      "Epoch 9: 100%|█| 11/11 [00:37<00:00,  3.39s/it, loss=-0.09611, test_loss=-0.1273\n",
      "Epoch 10: 100%|█| 11/11 [00:37<00:00,  3.38s/it, loss=-0.09640, test_loss=-0.127\n",
      "Epoch 11: 100%|█| 11/11 [00:37<00:00,  3.41s/it, loss=-0.09615, test_loss=-0.127\n",
      "Epoch 12: 100%|█| 11/11 [00:36<00:00,  3.36s/it, loss=-0.09627, test_loss=-0.127\n",
      "Epoch 13: 100%|█| 11/11 [00:35<00:00,  3.24s/it, loss=-0.09591, test_loss=-0.127\n",
      "Epoch 14: 100%|█| 11/11 [00:36<00:00,  3.29s/it, loss=-0.09664, test_loss=-0.127\n",
      "Epoch 0: 100%|█| 11/11 [00:34<00:00,  3.12s/it, loss=-0.16576, test_loss=-0.1562\n",
      "Epoch 1: 100%|█| 11/11 [00:33<00:00,  3.08s/it, loss=-0.16636, test_loss=-0.1562\n",
      "Epoch 2: 100%|█| 11/11 [00:34<00:00,  3.15s/it, loss=-0.16587, test_loss=-0.1561\n",
      "Epoch 3: 100%|█| 11/11 [00:33<00:00,  3.00s/it, loss=-0.16609, test_loss=-0.1561\n",
      "Epoch 4: 100%|█| 11/11 [00:34<00:00,  3.18s/it, loss=-0.16541, test_loss=-0.1561\n",
      "Epoch 5: 100%|█| 11/11 [00:33<00:00,  3.04s/it, loss=-0.16495, test_loss=-0.1560\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:34<00:00,  3.13s/it, loss=-0.09643, test_loss=-0.1320\n",
      "Epoch 1: 100%|█| 11/11 [00:36<00:00,  3.29s/it, loss=-0.09614, test_loss=-0.1320\n",
      "Epoch 2: 100%|█| 11/11 [00:35<00:00,  3.21s/it, loss=-0.09714, test_loss=-0.1320\n",
      "Epoch 3: 100%|█| 11/11 [00:36<00:00,  3.30s/it, loss=-0.09636, test_loss=-0.1320\n",
      "Epoch 4: 100%|█| 11/11 [00:36<00:00,  3.29s/it, loss=-0.09716, test_loss=-0.1320\n",
      "Epoch 5: 100%|█| 11/11 [00:35<00:00,  3.23s/it, loss=-0.09702, test_loss=-0.1320\n",
      "Epoch 6: 100%|█| 11/11 [00:35<00:00,  3.23s/it, loss=-0.09684, test_loss=-0.1320\n",
      "Epoch 7: 100%|█| 11/11 [00:34<00:00,  3.17s/it, loss=-0.09685, test_loss=-0.1320\n",
      "Epoch 8: 100%|█| 11/11 [00:35<00:00,  3.23s/it, loss=-0.09760, test_loss=-0.1320\n",
      "Epoch 9: 100%|█| 11/11 [00:35<00:00,  3.26s/it, loss=-0.09748, test_loss=-0.1320\n",
      "Epoch 10: 100%|█| 11/11 [00:34<00:00,  3.17s/it, loss=-0.09754, test_loss=-0.132\n",
      "Epoch 11: 100%|█| 11/11 [00:36<00:00,  3.28s/it, loss=-0.09782, test_loss=-0.132\n",
      "Epoch 12: 100%|█| 11/11 [00:34<00:00,  3.14s/it, loss=-0.09825, test_loss=-0.132\n",
      "Epoch 13: 100%|█| 11/11 [00:35<00:00,  3.21s/it, loss=-0.09818, test_loss=-0.131\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:35<00:00,  3.21s/it, loss=-0.12068, test_loss=-0.0826\n",
      "Epoch 1: 100%|█| 11/11 [00:36<00:00,  3.32s/it, loss=-0.12127, test_loss=-0.0827\n",
      "Epoch 2: 100%|█| 11/11 [00:38<00:00,  3.45s/it, loss=-0.12193, test_loss=-0.0827\n",
      "Epoch 3: 100%|█| 11/11 [00:35<00:00,  3.25s/it, loss=-0.12227, test_loss=-0.0828\n",
      "Epoch 4: 100%|█| 11/11 [00:36<00:00,  3.28s/it, loss=-0.12244, test_loss=-0.0828\n",
      "Epoch 5: 100%|█| 11/11 [00:35<00:00,  3.27s/it, loss=-0.12254, test_loss=-0.0829\n",
      "Epoch 6: 100%|█| 11/11 [00:35<00:00,  3.25s/it, loss=-0.12276, test_loss=-0.0830\n",
      "Epoch 7: 100%|█| 11/11 [00:36<00:00,  3.33s/it, loss=-0.12312, test_loss=-0.0831\n",
      "Epoch 8: 100%|█| 11/11 [00:35<00:00,  3.20s/it, loss=-0.12332, test_loss=-0.0831\n",
      "Epoch 9: 100%|█| 11/11 [00:36<00:00,  3.35s/it, loss=-0.12275, test_loss=-0.0832\n",
      "Epoch 10: 100%|█| 11/11 [00:36<00:00,  3.34s/it, loss=-0.12370, test_loss=-0.083\n",
      "Epoch 11: 100%|█| 11/11 [00:36<00:00,  3.34s/it, loss=-0.12377, test_loss=-0.083\n",
      "Epoch 12: 100%|█| 11/11 [00:37<00:00,  3.39s/it, loss=-0.12391, test_loss=-0.083\n",
      "Epoch 13: 100%|█| 11/11 [00:36<00:00,  3.29s/it, loss=-0.12391, test_loss=-0.083\n",
      "Epoch 14: 100%|█| 11/11 [00:36<00:00,  3.31s/it, loss=-0.12420, test_loss=-0.083\n",
      "Epoch 0: 100%|█| 11/11 [00:35<00:00,  3.24s/it, loss=-0.16153, test_loss=-0.1771\n",
      "Epoch 1: 100%|█| 11/11 [00:35<00:00,  3.27s/it, loss=-0.16183, test_loss=-0.1771\n",
      "Epoch 2: 100%|█| 11/11 [00:37<00:00,  3.40s/it, loss=-0.16201, test_loss=-0.1771\n",
      "Epoch 3: 100%|█| 11/11 [00:35<00:00,  3.25s/it, loss=-0.16246, test_loss=-0.1771\n",
      "Epoch 4: 100%|█| 11/11 [00:35<00:00,  3.22s/it, loss=-0.16271, test_loss=-0.1771\n",
      "Epoch 5: 100%|█| 11/11 [00:35<00:00,  3.25s/it, loss=-0.16299, test_loss=-0.1771\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-07 02:43:07,612]\u001b[0m Trial 17 finished with value: -0.13075299561023712 and parameters: {'lr': 0.00019628353719266484, 'hidden_channels': 5, 'kernel_size': 10, 'risk_aversion': 0.00010564461384069986, 'transaction_cost': 0.0009569021504085124, 'min_weight': 0.04309181340740031, 'max_weight': 0.515444540340573}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.74s/it, loss=-0.09614, test_loss=-0.1265\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.09877, test_loss=-0.1277\n",
      "Epoch 2: 100%|█| 11/11 [00:30<00:00,  2.82s/it, loss=-0.10058, test_loss=-0.1282\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.10195, test_loss=-0.1283\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.95s/it, loss=-0.10225, test_loss=-0.1286\n",
      "Epoch 5: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.10478, test_loss=-0.1289\n",
      "Epoch 6: 100%|█| 11/11 [00:31<00:00,  2.82s/it, loss=-0.10548, test_loss=-0.1289\n",
      "Epoch 7: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.10659, test_loss=-0.1289\n",
      "Epoch 8: 100%|█| 11/11 [00:30<00:00,  2.81s/it, loss=-0.10792, test_loss=-0.1292\n",
      "Epoch 9: 100%|█| 11/11 [00:29<00:00,  2.71s/it, loss=-0.11072, test_loss=-0.1308\n",
      "Epoch 10: 100%|█| 11/11 [00:30<00:00,  2.76s/it, loss=-0.11415, test_loss=-0.131\n",
      "Epoch 11: 100%|█| 11/11 [00:29<00:00,  2.69s/it, loss=-0.11689, test_loss=-0.132\n",
      "Epoch 12: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.12144, test_loss=-0.131\n",
      "Epoch 13: 100%|█| 11/11 [00:29<00:00,  2.66s/it, loss=-0.12457, test_loss=-0.130\n",
      "Epoch 14: 100%|█| 11/11 [00:29<00:00,  2.72s/it, loss=-0.12844, test_loss=-0.131\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.14596, test_loss=-0.1877\n",
      "Epoch 1: 100%|█| 11/11 [00:33<00:00,  3.07s/it, loss=-0.15007, test_loss=-0.1884\n",
      "Epoch 2: 100%|█| 11/11 [00:31<00:00,  2.90s/it, loss=-0.15394, test_loss=-0.1888\n",
      "Epoch 3: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.15610, test_loss=-0.1895\n",
      "Epoch 4: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.15816, test_loss=-0.1897\n",
      "Epoch 5: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.15950, test_loss=-0.1899\n",
      "Epoch 6: 100%|█| 11/11 [00:30<00:00,  2.79s/it, loss=-0.16164, test_loss=-0.1901\n",
      "Epoch 7: 100%|█| 11/11 [00:32<00:00,  2.97s/it, loss=-0.16335, test_loss=-0.1910\n",
      "Epoch 8: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.16610, test_loss=-0.1917\n",
      "Epoch 9: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.16986, test_loss=-0.1911\n",
      "Epoch 10: 100%|█| 11/11 [00:30<00:00,  2.78s/it, loss=-0.17247, test_loss=-0.190\n",
      "Epoch 11: 100%|█| 11/11 [00:31<00:00,  2.82s/it, loss=-0.17711, test_loss=-0.191\n",
      "Epoch 12: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.18023, test_loss=-0.190\n",
      "Epoch 13: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.18379, test_loss=-0.191\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.15056, test_loss=-0.0860\n",
      "Epoch 1: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.15412, test_loss=-0.0862\n",
      "Epoch 2: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.15591, test_loss=-0.0862\n",
      "Epoch 3: 100%|█| 11/11 [00:31<00:00,  2.91s/it, loss=-0.15847, test_loss=-0.0859\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.16021, test_loss=-0.0860\n",
      "Epoch 5: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.16356, test_loss=-0.0862\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.96s/it, loss=-0.16768, test_loss=-0.0867\n",
      "Epoch 7: 100%|█| 11/11 [00:31<00:00,  2.87s/it, loss=-0.17067, test_loss=-0.0866\n",
      "Epoch 8: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.17418, test_loss=-0.0862\n",
      "Epoch 9: 100%|█| 11/11 [00:31<00:00,  2.82s/it, loss=-0.17734, test_loss=-0.0869\n",
      "Epoch 10: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.17915, test_loss=-0.086\n",
      "Epoch 11: 100%|█| 11/11 [00:31<00:00,  2.86s/it, loss=-0.18148, test_loss=-0.087\n",
      "Epoch 12: 100%|█| 11/11 [00:31<00:00,  2.85s/it, loss=-0.18376, test_loss=-0.085\n",
      "Epoch 13: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.18731, test_loss=-0.086\n",
      "Epoch 14: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.19070, test_loss=-0.086\n",
      "Epoch 0: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.07606, test_loss=-0.1388\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.07707, test_loss=-0.1389\n",
      "Epoch 2: 100%|█| 11/11 [00:33<00:00,  3.09s/it, loss=-0.07881, test_loss=-0.1389\n",
      "Epoch 3: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.08148, test_loss=-0.1388\n",
      "Epoch 4: 100%|█| 11/11 [00:33<00:00,  3.06s/it, loss=-0.08323, test_loss=-0.1381\n",
      "Epoch 5: 100%|█| 11/11 [00:33<00:00,  3.06s/it, loss=-0.08528, test_loss=-0.1376\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.97s/it, loss=-0.08797, test_loss=-0.1378\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.18152, test_loss=-0.1716\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.18347, test_loss=-0.1719\n",
      "Epoch 2: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.18494, test_loss=-0.1728\n",
      "Epoch 3: 100%|█| 11/11 [00:33<00:00,  3.03s/it, loss=-0.18664, test_loss=-0.1734\n",
      "Epoch 4: 100%|█| 11/11 [00:33<00:00,  3.08s/it, loss=-0.18816, test_loss=-0.1735\n",
      "Epoch 5: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.18996, test_loss=-0.1744\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.98s/it, loss=-0.19213, test_loss=-0.1752\n",
      "Epoch 7: 100%|█| 11/11 [00:34<00:00,  3.09s/it, loss=-0.19407, test_loss=-0.1753\n",
      "Epoch 8: 100%|█| 11/11 [00:33<00:00,  3.04s/it, loss=-0.19746, test_loss=-0.1750\n",
      "Epoch 9: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.19818, test_loss=-0.1760\n",
      "Epoch 10: 100%|█| 11/11 [00:33<00:00,  3.01s/it, loss=-0.20234, test_loss=-0.176\n",
      "Epoch 11: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.20525, test_loss=-0.177\n",
      "Epoch 12: 100%|█| 11/11 [00:32<00:00,  2.99s/it, loss=-0.20877, test_loss=-0.176\n",
      "Epoch 13: 100%|█| 11/11 [00:33<00:00,  3.04s/it, loss=-0.21146, test_loss=-0.176\n",
      "Epoch 14: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.21430, test_loss=-0.177\n",
      "\u001b[32m[I 2021-12-07 03:18:48,850]\u001b[0m Trial 18 finished with value: -0.13689520955085754 and parameters: {'lr': 0.0008021481087086221, 'hidden_channels': 10, 'kernel_size': 9, 'risk_aversion': 1.4200457428992859, 'transaction_cost': 0.002053571008378023, 'min_weight': 0.030728338905585018, 'max_weight': 0.659481733883587}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n",
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.89s/it, loss=-0.08587, test_loss=-0.1387\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.99s/it, loss=-0.08749, test_loss=-0.1379\n",
      "Epoch 2: 100%|█| 11/11 [00:30<00:00,  2.80s/it, loss=-0.09166, test_loss=-0.1414\n",
      "Epoch 3: 100%|█| 11/11 [00:30<00:00,  2.74s/it, loss=-0.09792, test_loss=-0.1349\n",
      "Epoch 4: 100%|█| 11/11 [00:28<00:00,  2.59s/it, loss=-0.10632, test_loss=-0.1245\n",
      "Epoch 5: 100%|█| 11/11 [00:27<00:00,  2.54s/it, loss=-0.11912, test_loss=-0.1349\n",
      "Epoch 6: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.14656, test_loss=-0.1333\n",
      "Epoch 7: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.16478, test_loss=-0.1339\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:31<00:00,  2.88s/it, loss=-0.11449, test_loss=-0.2098\n",
      "Epoch 1: 100%|█| 11/11 [00:33<00:00,  3.06s/it, loss=-0.11726, test_loss=-0.2090\n",
      "Epoch 2: 100%|█| 11/11 [00:32<00:00,  2.93s/it, loss=-0.11912, test_loss=-0.2095\n",
      "Epoch 3: 100%|█| 11/11 [00:32<00:00,  2.99s/it, loss=-0.12048, test_loss=-0.2098\n",
      "Epoch 4: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.12128, test_loss=-0.2100\n",
      "Epoch 5: 100%|█| 11/11 [00:32<00:00,  2.99s/it, loss=-0.12199, test_loss=-0.2078\n",
      "Epoch 6: 100%|█| 11/11 [00:32<00:00,  2.94s/it, loss=-0.12471, test_loss=-0.2090\n",
      "Epoch 7: 100%|█| 11/11 [00:31<00:00,  2.84s/it, loss=-0.13161, test_loss=-0.2124\n",
      "Epoch 8: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.13994, test_loss=-0.2138\n",
      "Epoch 9: 100%|█| 11/11 [00:29<00:00,  2.67s/it, loss=-0.15940, test_loss=-0.2114\n",
      "Epoch 10: 100%|█| 11/11 [00:27<00:00,  2.52s/it, loss=-0.17441, test_loss=-0.207\n",
      "Epoch 11: 100%|█| 11/11 [00:26<00:00,  2.43s/it, loss=-0.19233, test_loss=-0.213\n",
      "Epoch 12: 100%|█| 11/11 [00:23<00:00,  2.15s/it, loss=-0.20458, test_loss=-0.208\n",
      "Epoch 13: 100%|█| 11/11 [00:23<00:00,  2.16s/it, loss=-0.21677, test_loss=-0.208\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:30<00:00,  2.82s/it, loss=-0.10445, test_loss=-0.1270\n",
      "Epoch 1: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.10706, test_loss=-0.1245\n",
      "Epoch 2: 100%|█| 11/11 [00:29<00:00,  2.65s/it, loss=-0.10388, test_loss=-0.1281\n",
      "Epoch 3: 100%|█| 11/11 [00:29<00:00,  2.68s/it, loss=-0.10671, test_loss=-0.1241\n",
      "Epoch 4: 100%|█| 11/11 [00:27<00:00,  2.52s/it, loss=-0.10458, test_loss=-0.1277\n",
      "Epoch 5: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.10285, test_loss=-0.1282\n",
      "Epoch 6: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.10568, test_loss=-0.1319\n",
      "Epoch 7: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.10510, test_loss=-0.1358\n",
      "Epoch 8: 100%|█| 11/11 [00:26<00:00,  2.42s/it, loss=-0.10666, test_loss=-0.1357\n",
      "Epoch 9: 100%|█| 11/11 [00:25<00:00,  2.31s/it, loss=-0.11002, test_loss=-0.1380\n",
      "Epoch 10: 100%|█| 11/11 [00:26<00:00,  2.40s/it, loss=-0.11209, test_loss=-0.141\n",
      "Epoch 11: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.11477, test_loss=-0.149\n",
      "Epoch 12: 100%|█| 11/11 [00:25<00:00,  2.35s/it, loss=-0.11556, test_loss=-0.149\n",
      "Epoch 13: 100%|█| 11/11 [00:25<00:00,  2.34s/it, loss=-0.13874, test_loss=-0.150\n",
      "Epoch 14: 100%|█| 11/11 [00:25<00:00,  2.32s/it, loss=-0.13457, test_loss=-0.148\n",
      "Epoch 0: 100%|█| 11/11 [00:32<00:00,  3.00s/it, loss=-0.09166, test_loss=-0.1129\n",
      "Epoch 1: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.09311, test_loss=-0.1130\n",
      "Epoch 2: 100%|█| 11/11 [00:32<00:00,  2.92s/it, loss=-0.09612, test_loss=-0.1126\n",
      "Epoch 3: 100%|█| 11/11 [00:33<00:00,  3.05s/it, loss=-0.09963, test_loss=-0.1154\n",
      "Epoch 4: 100%|█| 11/11 [00:31<00:00,  2.83s/it, loss=-0.10436, test_loss=-0.1166\n",
      "Epoch 5: 100%|█| 11/11 [00:30<00:00,  2.74s/it, loss=-0.11012, test_loss=-0.1275\n",
      "Epoch 6: 100%|█| 11/11 [00:27<00:00,  2.51s/it, loss=-0.13144, test_loss=-0.1217\n",
      "Epoch 7: 100%|█| 11/11 [00:26<00:00,  2.45s/it, loss=-0.14321, test_loss=-0.1274\n",
      "Epoch 8: 100%|█| 11/11 [00:25<00:00,  2.29s/it, loss=-0.15187, test_loss=-0.1263\n",
      "Epoch 9:  64%|████████████▋       | 7/11 [00:10<00:05,  1.46s/it, loss=-0.15948]/opt/anaconda3/envs/Capstone/lib/python3.7/site-packages/diffcp/cone_program.py:296: UserWarning: Solved/Inaccurate.\n",
      "  warnings.warn(\"Solved/Inaccurate.\")\n",
      "Epoch 9: 100%|█| 11/11 [00:26<00:00,  2.44s/it, loss=-0.16871, test_loss=-0.1164\n",
      "Epoch 10: 100%|█| 11/11 [00:24<00:00,  2.20s/it, loss=-0.18158, test_loss=-0.116\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 11/11 [00:29<00:00,  2.73s/it, loss=-0.19453, test_loss=-0.1428\n",
      "Epoch 1: 100%|█| 11/11 [00:28<00:00,  2.57s/it, loss=-0.20849, test_loss=-0.1453\n",
      "Epoch 2: 100%|█| 11/11 [00:25<00:00,  2.30s/it, loss=-0.22018, test_loss=-0.1467\n",
      "Epoch 3: 100%|█| 11/11 [00:24<00:00,  2.25s/it, loss=-0.23758, test_loss=-0.1413\n",
      "Epoch 4: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.25267, test_loss=-0.1352\n",
      "Epoch 5: 100%|█| 11/11 [00:24<00:00,  2.23s/it, loss=-0.25697, test_loss=-0.1366\n",
      "Epoch 6: 100%|█| 11/11 [00:22<00:00,  2.09s/it, loss=-0.26952, test_loss=-0.1313\n",
      "Epoch 7: 100%|█| 11/11 [00:23<00:00,  2.12s/it, loss=-0.27202, test_loss=-0.1288\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\u001b[32m[I 2021-12-07 03:45:42,906]\u001b[0m Trial 19 finished with value: -0.14981092512607574 and parameters: {'lr': 0.005120261079633179, 'hidden_channels': 9, 'kernel_size': 10, 'risk_aversion': 958.3474447796672, 'transaction_cost': 8.104037693562523e-05, 'min_weight': 0.041141399778489234, 'max_weight': 0.8308067232449362}. Best is trial 6 with value: -0.14997509121894836.\u001b[0m\n"
     ]
    }
   ],
   "source": [
    "best_params = tuner()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "2c5153b5",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'lr': 0.0014972506254682862,\n",
       " 'hidden_channels': 10,\n",
       " 'kernel_size': 8,\n",
       " 'risk_aversion': 0.00027119651040450254,\n",
       " 'transaction_cost': 0.00028078437047290313,\n",
       " 'min_weight': 0.028642497538500695,\n",
       " 'max_weight': 0.6392841712179271}"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "best_params"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1f47b9e3",
   "metadata": {},
   "source": [
    "### Train model offline on entire training set"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "f9316f11",
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.model_selection import train_test_split"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 108,
   "id": "12b47bef",
   "metadata": {},
   "outputs": [],
   "source": [
    "model = IEEE_MPO(hidden_channels=best_params['hidden_channels'],\n",
    "                 kernel_size=best_params['kernel_size'],\n",
    "                 risk_aversion=best_params['risk_aversion'],\n",
    "                 transaction_cost=best_params['transaction_cost'],\n",
    "                 min_weight = best_params['min_weight'],\n",
    "                 max_weight = best_params['max_weight']\n",
    "                 )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 109,
   "id": "d5efcfc0",
   "metadata": {},
   "outputs": [],
   "source": [
    "optimizer = torch.optim.Adam(model.parameters(), best_params['lr'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 110,
   "id": "44d9b0e6",
   "metadata": {},
   "outputs": [],
   "source": [
    "idx_train, idx_val = train_test_split(indices_train, test_size=0.2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 111,
   "id": "32991fee",
   "metadata": {},
   "outputs": [],
   "source": [
    "dataloader_train = RigidDataLoader(dataset,\n",
    "                                   indices=idx_train,\n",
    "                                   batch_size=32)\n",
    "dataloader_validate = RigidDataLoader(dataset,\n",
    "                                   indices=idx_val,\n",
    "                                   batch_size=32)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 112,
   "id": "d91973fb",
   "metadata": {},
   "outputs": [],
   "source": [
    "PVM = pd.DataFrame(1/n_assets, index=np.arange(len(indices_train) + 1), columns=np.arange(n_assets))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 113,
   "id": "066a135d",
   "metadata": {},
   "outputs": [],
   "source": [
    "run = Run(model,\n",
    "          loss,\n",
    "          dataloader_train,\n",
    "          PVM,\n",
    "          val_dataloaders={'test': dataloader_validate},\n",
    "          callbacks=callbacks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 114,
   "id": "39989622",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█| 22/22 [00:32<00:00,  1.48s/it, loss=-0.11722, test_loss=-0.1912\n",
      "Epoch 1: 100%|█| 22/22 [00:32<00:00,  1.48s/it, loss=-0.12679, test_loss=-0.2047\n",
      "Epoch 2: 100%|█| 22/22 [00:32<00:00,  1.47s/it, loss=-0.12827, test_loss=-0.1763\n",
      "Epoch 3: 100%|█| 22/22 [00:29<00:00,  1.32s/it, loss=-0.13715, test_loss=-0.1757\n",
      "Epoch 4: 100%|█| 22/22 [00:31<00:00,  1.42s/it, loss=-0.13463, test_loss=-0.2072\n",
      "Epoch 5: 100%|█| 22/22 [00:29<00:00,  1.34s/it, loss=-0.13513, test_loss=-0.1789\n",
      "Epoch 6: 100%|█| 22/22 [00:27<00:00,  1.25s/it, loss=-0.14508, test_loss=-0.1678\n",
      "Epoch 7: 100%|█| 22/22 [00:30<00:00,  1.39s/it, loss=-0.16389, test_loss=-0.1923\n",
      "Epoch 8: 100%|█| 22/22 [00:25<00:00,  1.18s/it, loss=-0.17615, test_loss=-0.1941\n",
      "Epoch 9: 100%|█| 22/22 [00:25<00:00,  1.16s/it, loss=-0.18054, test_loss=-0.1800\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training interrupted\n",
      "Training stopped early because there was no improvement in test_loss for 5 epochs\n"
     ]
    }
   ],
   "source": [
    "history = run.launch(30)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e6995b94",
   "metadata": {},
   "source": [
    "### Test Evaluation without online learning"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 115,
   "id": "36b7921d",
   "metadata": {},
   "outputs": [],
   "source": [
    "dataloader_test = RigidDataLoader(dataset,\n",
    "                                   indices=indices_test,\n",
    "                                   batch_size=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 116,
   "id": "35da39e8",
   "metadata": {},
   "outputs": [],
   "source": [
    "offline_weights = pd.DataFrame(0, index=indices_test, columns=np.arange(20))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 117,
   "id": "3419280f",
   "metadata": {},
   "outputs": [],
   "source": [
    "index = np.concatenate([indices_test,\n",
    "                        np.array([indices_test[-1] + 1])])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 118,
   "id": "98e60277",
   "metadata": {},
   "outputs": [],
   "source": [
    "PVM = pd.DataFrame(1/20, index=index, columns=np.arange(20))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 119,
   "id": "b7483374",
   "metadata": {},
   "outputs": [],
   "source": [
    "model = model.eval()\n",
    "with torch.no_grad():\n",
    "    for batch_ix, (X_batch, y_batch, timestamps, _) in enumerate(dataloader_test):\n",
    "\n",
    "        prev_w = torch.FloatTensor(PVM.loc[timestamps].values)\n",
    "\n",
    "        weights = model(X_batch.float(), prev_w)\n",
    "\n",
    "        actions = weights[:, 0, :].detach().cpu().numpy()\n",
    "\n",
    "        PVM.loc[np.asarray(timestamps) + 1] = actions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 120,
   "id": "5108f8ed",
   "metadata": {},
   "outputs": [],
   "source": [
    "offline_weights.loc[indices_test] = PVM.iloc[1:, :].values"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c6d4e5d0",
   "metadata": {},
   "source": [
    "### Online Learning and test set evalution using rolling cross validation"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 123,
   "id": "62db7ae9",
   "metadata": {},
   "outputs": [],
   "source": [
    "model = model.train()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 125,
   "id": "1700a867",
   "metadata": {},
   "outputs": [],
   "source": [
    "OL = OnlineLearning(model, dataset, indices_test, optimizer, loss, batch_size=1, n_epochs=5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 126,
   "id": "2edece39",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Epoch 0: 100%|█████████████████| 12/12 [00:00<00:00, 12.40it/s, loss=-0.06229, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:00<00:00, 12.22it/s, loss=-0.12235, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00, 11.66it/s, loss=-0.16980, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:00<00:00, 12.35it/s, loss=-0.17193, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:00<00:00, 12.32it/s, loss=-0.21217, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 11.88it/s, loss=-0.15154, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:01<00:00, 11.28it/s, loss=-0.08168, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00,  9.67it/s, loss=-0.09545, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00,  9.51it/s, loss=-0.11769, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:01<00:00, 11.57it/s, loss=-0.11965, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 11.30it/s, loss=-0.21572, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:01<00:00, 11.59it/s, loss=-0.22891, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00, 11.59it/s, loss=-0.30632, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00, 11.94it/s, loss=-0.30532, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:01<00:00, 10.90it/s, loss=-0.32688, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 11.28it/s, loss=-0.51150, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:01<00:00, 11.37it/s, loss=-0.49655, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00, 11.71it/s, loss=-0.44000, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00, 11.72it/s, loss=-0.33772, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:01<00:00,  9.96it/s, loss=-0.32560, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 10.57it/s, loss=-0.32346, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:01<00:00, 11.82it/s, loss=-0.36125, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:00<00:00, 12.10it/s, loss=-0.40572, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00, 11.36it/s, loss=-0.45880, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:00<00:00, 12.08it/s, loss=-0.48074, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00,  9.34it/s, loss=-0.09817, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:01<00:00,  9.02it/s, loss=-0.17476, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00,  9.27it/s, loss=-0.22301, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00,  9.55it/s, loss=-0.28311, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:01<00:00,  8.10it/s, loss=-0.36496, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 10.07it/s, loss=-0.07525, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:01<00:00, 10.22it/s, loss=-0.19744, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00, 11.19it/s, loss=-0.22186, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00, 11.29it/s, loss=-0.23766, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:01<00:00, 10.62it/s, loss=-0.27017, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 10.49it/s, loss=-0.35391, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:01<00:00, 10.36it/s, loss=-0.39656, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00, 11.29it/s, loss=-0.37058, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00, 10.65it/s, loss=-0.45591, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:01<00:00, 10.82it/s, loss=-0.47322, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 11.12it/s, loss=-0.04153, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:01<00:00, 11.49it/s, loss=-0.11167, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00, 11.19it/s, loss=-0.17373, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00, 11.12it/s, loss=-0.24505, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:01<00:00, 11.89it/s, loss=-0.26831, ]\n",
      "Epoch 0: 100%|██████████████████| 12/12 [00:01<00:00, 10.24it/s, loss=0.36678, ]\n",
      "Epoch 1: 100%|██████████████████| 12/12 [00:01<00:00, 10.49it/s, loss=0.27655, ]\n",
      "Epoch 2: 100%|██████████████████| 12/12 [00:01<00:00, 11.42it/s, loss=0.21587, ]\n",
      "Epoch 3: 100%|██████████████████| 12/12 [00:01<00:00, 11.36it/s, loss=0.18900, ]\n",
      "Epoch 4: 100%|██████████████████| 12/12 [00:01<00:00,  9.97it/s, loss=0.18475, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 11.45it/s, loss=-0.33471, ]\n",
      "Epoch 1: 100%|█████████████████| 12/12 [00:00<00:00, 12.01it/s, loss=-0.29810, ]\n",
      "Epoch 2: 100%|█████████████████| 12/12 [00:01<00:00, 11.57it/s, loss=-0.29845, ]\n",
      "Epoch 3: 100%|█████████████████| 12/12 [00:01<00:00, 11.98it/s, loss=-0.29041, ]\n",
      "Epoch 4: 100%|█████████████████| 12/12 [00:01<00:00, 11.64it/s, loss=-0.29963, ]\n",
      "Epoch 0: 100%|██████████████████| 12/12 [00:01<00:00, 10.76it/s, loss=0.41906, ]\n",
      "Epoch 1: 100%|██████████████████| 12/12 [00:01<00:00, 10.83it/s, loss=0.43792, ]\n",
      "Epoch 2: 100%|██████████████████| 12/12 [00:01<00:00, 11.18it/s, loss=0.43316, ]\n",
      "Epoch 3: 100%|██████████████████| 12/12 [00:01<00:00, 11.29it/s, loss=0.43255, ]\n",
      "Epoch 4: 100%|██████████████████| 12/12 [00:01<00:00, 11.64it/s, loss=0.39781, ]\n",
      "Epoch 0: 100%|█████████████████| 12/12 [00:01<00:00, 10.70it/s, loss=-0.04063, ]\n",
      "Epoch 1: 100%|██████████████████| 12/12 [00:01<00:00,  9.90it/s, loss=0.00263, ]\n",
      "Epoch 2: 100%|██████████████████| 12/12 [00:01<00:00, 10.80it/s, loss=0.00841, ]\n",
      "Epoch 3: 100%|██████████████████| 12/12 [00:01<00:00, 11.56it/s, loss=0.01410, ]\n",
      "Epoch 4: 100%|██████████████████| 12/12 [00:01<00:00, 11.84it/s, loss=0.01371, ]\n",
      "Epoch 0: 100%|██████████████████| 12/12 [00:01<00:00, 10.33it/s, loss=0.10883, ]\n",
      "Epoch 1: 100%|██████████████████| 12/12 [00:01<00:00, 10.16it/s, loss=0.09297, ]\n",
      "Epoch 2: 100%|██████████████████| 12/12 [00:01<00:00, 11.32it/s, loss=0.07821, ]\n",
      "Epoch 3: 100%|██████████████████| 12/12 [00:01<00:00, 11.14it/s, loss=0.07978, ]\n",
      "Epoch 4: 100%|██████████████████| 12/12 [00:01<00:00, 11.83it/s, loss=0.08042, ]\n",
      "Epoch 0: 100%|██████████████████| 10/10 [00:00<00:00, 11.20it/s, loss=0.34457, ]\n",
      "Epoch 1: 100%|██████████████████| 10/10 [00:00<00:00, 12.10it/s, loss=0.38023, ]\n",
      "Epoch 2: 100%|██████████████████| 10/10 [00:00<00:00, 12.32it/s, loss=0.41372, ]\n",
      "Epoch 3: 100%|██████████████████| 10/10 [00:00<00:00, 12.89it/s, loss=0.40177, ]\n",
      "Epoch 4: 100%|██████████████████| 10/10 [00:00<00:00, 12.89it/s, loss=0.40054, ]\n"
     ]
    }
   ],
   "source": [
    "online_weights = OL()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 142,
   "id": "0d57456b",
   "metadata": {},
   "outputs": [],
   "source": [
    "offline_weights.columns = [str(i) for i in offline_weights.columns]\n",
    "offline_weights.to_parquet('offline_weights.prq')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 143,
   "id": "de4807b8",
   "metadata": {},
   "outputs": [],
   "source": [
    "online_weights.columns = [str(i) for i in offline_weights.columns]\n",
    "online_weights.to_parquet('online_weights.prq')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "14258d07",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
